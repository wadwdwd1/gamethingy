var FamobiApi=pc.createScript("famobiApi");pc.extend(FamobiApi.prototype,{initialize:function(){window.famobi=window.famobi||{},window.famobi.localStorage=window.famobi.localStorage||window.localStorage,window.famobi.sessionStorage=window.famobi.sessionStorage||window.sessionStorage,pc.famobiAPI=this},gameReady:function(){try{window.famobi.gameReady()}catch(t){console.warn(t)}},getBrandingButtonImage:function(){return window.famobi.getBrandingButtonImage()},setPreloadProgress:function(t){window.famobi.setPreloadProgress(t)},moreGamesLink:function(){window.famobi.moreGamesLink()},showInterstitialAd:function(){return window.famobi.showInterstitialAd()},showAd:function(){try{return window.famobi.showAd()}catch(t){}},hasRewardedAd:function(){return window.famobi.hasRewardedAd()},rewardedAd:function(t,e){window.famobi.rewardedAd(t.bind(e))},setOnPauseRequested:function(t,e){window.famobi_onPauseRequested=t.bind(e||this)},setOnResumeRequested:function(t,e){window.famobi_onResumeRequested=t.bind(e||this)},get:function(t){return window.famobi.__(t)||t},getCurrentLanguage:function(){return window.famobi.getCurrentLanguage()},setLocalStorageItem:function(t,e){window.famobi.localStorage.setItem(t,e)},getLocalStorageItem:function(t){return window.famobi.localStorage.getItem(t)},removeLocalStorageItem:function(t){window.famobi.localStorage.removeItem(t)},clearLocalStorage:function(){window.famobi.localStorage.clear()},setSessionStorageItem:function(t,e){window.famobi.sessionStorage.setItem(t,e)},getSessionStorageItem:function(t){window.famobi.sessionStorage.getItem(t)},removeSessionStorageItem:function(t){window.famobi.sessionStorage.removeItem(t)},clearSessionStorage:function(){window.famobi.sessionStorage.clear()},getOrientation:function(){return window.famobi.getOrientation()},setOnOrientationChange:function(t,e){window.famobi.onOrientationChange(t.bind(e))},hasFeature:function(t){return window.famobi.hasFeature(t)},onRequest:function(t,e){window.famobi.onRequest(t,e)},getFeatureProperties:function(t){return window.famobi.getFeatureProperties(t)},getVolume:function(){return window.famobi.getVolume()},playerReady:function(){window.famobi.playerReady()}}),pc.extend(FamobiApi.prototype,{getMoreGamesButtonImage:function(){console.warn("GetMoreGamesButtonImage is deprecated, use getBrandingButtonImage instead"),this.getBrandingButtonImage()},moreGamesLink:function(){console.warn("moreGamesLink is deprecated, use openBrandingLink instead"),this.openBrandingLink()},submitHighscore:function(){console.warn("submitHighscore is deprecated, use window.famobi_analytics.trackEvent instead")},levelUp:function(){console.warn("levelUp is deprecated, use window.famobi_analytics.trackEvent instead")},gameOver:function(){console.warn("gameOver is deprecated, use window.famobi_analytics.trackEvent instead")}});var AudioManager=pc.createScript("audioManager");AudioManager.attributes.add("bgm",{type:"asset",array:!0}),AudioManager.attributes.add("sfx",{type:"asset",array:!0}),AudioManager.attributes.add("bgmVolume",{type:"number",default:.25,min:0,max:1}),AudioManager.attributes.add("bgmVolumeMultiplier",{type:"number",default:1,min:0,max:1}),AudioManager.attributes.add("sfxVolume",{type:"number",default:1,min:0,max:1}),AudioManager.attributes.add("sfxVolumeMultiplier",{type:"number",default:1,min:0,max:1}),AudioManager.attributes.add("autoPlayBGMIndex",{type:"number",default:0}),AudioManager.attributes.add("bgmSettingKey",{type:"string",default:"music"}),AudioManager.attributes.add("sfxSettingKey",{type:"string",default:"",description:"Leave this empty if there is only one setting for all sounds"}),AudioManager.attributes.add("userVolume",{type:"number",default:1}),AudioManager.attributes.add("userSFX",{type:"number",default:1}),pc.extend(AudioManager.prototype,{initialize:function(){pc.audioManager=this,this.soundPlayer=this.entity.addComponent("sound"),this.soundPlayer.positional=!1,this.activeMusicSlot=null,this.activeMusicName=null,this.allowOverlap=!0,this.useBGM=!0,this.useSFX=!0,this._bgmSlots={},this._sfxSlots={},this.app.on("Audio:sfx",this._playSFX,this),this.app.on("Audio:bgm",this._playBGM,this),this.on("attr:userVolume",this._setSFXVolume,this),this.on("attr:userVolume",this._setBGMVolume,this),this.on("attr:userSFX",this._setSFXVolume,this),this.on("attr:userSFX",this._setBGMVolume,this),this.on("attr:bgmVolumeMultiplier",function(){this._setBGMVolume(1)},this),this.on("attr:sfxVolumeMultiplier",function(){this._setSFXVolume(1)},this),this.app.context._soundManager.context&&"suspended"===this.app.context._soundManager.context.state&&this.app.once("inputManager:Input",this._onResumeContext,this)},postInitialize:function(){pc.famobiAPI.setOnPauseRequested(this.mute,this),pc.famobiAPI.setOnResumeRequested(this.unmute,this),pc.famobiAPI.onRequest("enableAudio",()=>{this.userSFX=1}),pc.famobiAPI.onRequest("disableAudio",()=>{this.userSFX=0}),pc.famobiAPI.onRequest("changeVolume",t=>{this.userVolume=t}),this.userVolume=pc.famobiAPI.getVolume(),this.setBGMSetting(pc.storageManager.get(this.bgmSettingKey),!0),this.sfxSettingKey&&this.setSFXSetting(pc.storageManager.get(this.sfxSettingKey),!0),this._loadSounds(),this._setBGMVolume(1),this._setSFXVolume(1)},_loadSounds:function(){for(var t=0;t<this.bgm.length;t+=1)if(this.bgm[t]instanceof pc.Asset)if(this._bgmSlots[this.bgm[t].name]=0,this.bgm[t].resource){var e=this._createBGMSlot(this.bgm[t]);this.activeMusicName=this.bgm[t].name,t===this.autoPlayBGMIndex&&this._playBGMSlot(e)}else t===this.autoPlayBGMIndex?(this.activeMusicName=this.bgm[t].name,pc.lazyLoader.lazyLoad(this.bgm[t],function(t){this._onBGMLoadComplete(t,!0)},this)):pc.lazyLoader.lazyLoad(this.bgm[t],function(t){this._onBGMLoadComplete(t,!1)},this);else console.warn("BGM with index "+t+" is not an asset!");for(var i=0;i<this.sfx.length;i+=1)this.sfx[t]instanceof pc.Asset?(this._sfxSlots[this.sfx[t].name]=0,this.sfx[i].resource?this._createSFXSlot(this.sfx[i]):pc.lazyLoader.lazyLoad(this.sfx[i],this._onSFXLoadComplete,this)):console.warn("BGM with index "+t+" is not an asset!")},_onBGMLoadComplete:function(t,e){var i=this._createBGMSlot(t);e&&this._playBGMSlot(i)},_onSFXLoadComplete:function(t){this._createSFXSlot(t)},_createBGMSlot:function(t){var e=this.soundPlayer.addSlot(t.name,{asset:t.id,volume:("number"==typeof this._bgmVolume?this._bgmVolume:1)*this.bgmVolumeMultiplier,pitch:1,loop:!0,overlap:!1});return this._bgmSlots[t.name]=e,e},_createSFXSlot:function(t){var e=this.soundPlayer.addSlot(t.name,{asset:t.id,volume:("number"==typeof this._sfxVolume?this._sfxVolume:1)*this.sfxVolumeMultiplier,pitch:1,loop:!1,overlap:!0});return this._sfxSlots[t.name]=e,e},_onResumeContext:function(){this.app.context._soundManager.context.resume()},_playSFX:function(t){var e=this._sfxSlots[t];if(e)this._playSFXSlot(e);else switch(e){case void 0:console.warn("Sound slot with the name ["+t+"] is not found");break;case 0:console.warn("Sound slot with the name "+t+" is still loading");break;default:console.warn("Something went wrong with the sound. Value is "+e)}},_playBGM:function(t){var e=this._bgmSlots[t];if(this.activeMusicName=t,e)this._playBGMSlot(e);else switch(e){case void 0:console.warn("Sound slot with the name ["+t+"] is not found");break;case 0:console.warn("Sound slot with the name "+t+" is still loading");break;default:console.warn("Something went wrong with the sound. Value is "+e)}},_playBGMSlot:function(t){this.activeMusicSlot===t&&this.activeMusicSlot.isPlaying?console.warn("Can't play the same bgm twice"):this.activeMusicName===t.name?("suspended"===this.app.context._soundManager.context.state&&this._onResumeContext(),this._stopMusic(),this.useBGM&&(this.activeMusicSlot=t,this.activeMusicSlot.play())):window.famobi.log("Trying to play "+t.name+", but currently playing "+this.activeMusicName)},_playSFXSlot:function(t){this.useSFX&&t.play()},_stopMusic:function(){this.activeMusicSlot&&(this.activeMusicSlot.stop(),this.activeMusicSlot=null)},_setBGMVolume:function(t){var e=Object.keys(this._bgmSlots);this._bgmVolume=t*this.bgmVolume;for(var i=0;i<e.length;i+=1)"object"==typeof this._bgmSlots[e[i]]&&(this._bgmSlots[e[i]].volume=t*this.bgmVolumeMultiplier*this.userVolume*this.userSFX)},_setSFXVolume:function(t){var e=Object.keys(this._sfxSlots);this._sfxVolume=t*this.sfxVolume;for(var i=0;i<e.length;i+=1)"object"==typeof this._sfxSlots[e[i]]&&(this._sfxSlots[e[i]].volume=t*this.sfxVolumeMultiplier*this.userVolume*this.userSFX)},setBGMSetting:function(t,e){if(t=Number(t),!isNaN(t))return t=pc.math.clamp(t,0,1),e||pc.storageManager.set(this.bgmSettingKey,t),this._setBGMVolume(t),this.bgmSettingKey&&!this.sfxSettingKey&&this.setSFXSetting(t),this.useBGM;console.warn("Volume is NaN!",t)},setSFXSetting:function(t,e){if(t=Number(t),!isNaN(t))return t=pc.math.clamp(t,0,1),this.useSFX=!!t,this.sfxSettingKey&&!e&&pc.storageManager.set(this.sfxSettingKey,t),this._setSFXVolume(t),this.useSFX;console.warn("Volume is NaN!",t)},mute:function(t){this.app.systems.sound.volume=0},unmute:function(t){this.app.systems.sound.volume=1}});var GameManager=pc.createScript("gameManager");GameManager.attributes.add("ball",{type:"entity"}),GameManager.attributes.add("playerBat",{type:"entity"}),GameManager.attributes.add("enemyBat",{type:"entity"}),GameManager.attributes.add("canSkipLevels",{type:"boolean",default:!1}),GameManager.attributes.add("startButton",{type:"entity"}),pc.extend(GameManager.prototype,{initialize:function(){pc.gameManager=this,this.level=0,this.score=0,this.states=Object.freeze({MENU:0,START:1,GAME:2,PAUSE:3,END:4}),this.app.on("UIManager:uiOpened",this.onUIOpen,this),this.currentState=this.states.MENU,this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.forcedMode=pc.famobiAPI.hasFeature("forced_mode"),this.forcedMode&&(this.forcedModeProperties=pc.famobiAPI.getFeatureProperties("forced_mode"))},postInitialize:function(){this.forcedMode||this.checkReady()},pause:function(){this.app.timeScale=0},unpause:function(){this.app.timeScale=1},checkReady:function(){this.externalStartChecked||(pc.famobiAPI.hasFeature("external_start")&&(this.pause(),pc.famobiAPI.onRequest("startGame",()=>{this.unpause()})),this.externalStartChecked=!0),pc.famobiAPI.gameReady(),this.app.fire("GameManager:ready")},reset:function(){this.app.fire("GameManager:reset")},fullReset:function(){this.app.fire("GameManager:fullReset"),this.reset()},start:function(){this.app.fire("GameManager:start")},getBall:function(){return this.ball},getPlayerBat:function(){return this.playerBat},getEnemyBat:function(){return this.enemyBat},setAllSettings:function(){this.level=0,this.forcedMode&&"number"==typeof this.forcedModeProperties.state.level&&(this.level=this.forcedModeProperties.state.level-1),this.increaseLevel(),this.forcedMode&&(this.startButton.script.eventTrackButton._onClick(),this.checkReady()),pc.setManager.resetPlayerLives(),pc.setManager.setLevel(this.level),pc.scoreManager.resetBonus()},addPointToEnemy:function(){var t=pc.setManager.removePlayerLives();this.app.fire("GameManager:roundCompleteEnemy"),t<=0?setTimeout(function(){if(this.forcedMode){var t=window.famobi_analytics.trackEvent(window.famobi_analytics.EVENT_LEVELFAIL,{levelName:"level_"+this.level,reason:"dead"}),e=window.famobi_analytics.trackEvent(window.famobi_analytics.EVENT_TOTALSCORE,{totalScore:pc.scoreManager.score}),i=window.famobi_analytics.trackEvent(window.famobi_analytics.EVENT_CUSTOM,{eventName:"LEVELEND",result:"fail",score:pc.scoreManager.score});Promise.all([t,e,i]).then(function(){this.app.fire("Audio:sfx","sfx_defeat.mp3"),this.app.fire("UIManager:showUI","Lose Screen"),this.app.fire("UIManager:hideUI","Game Screen"),StatisticsManager.instance.incrementStatistic("statistics_game_lost",1)}.bind(this))}else this.app.fire("Audio:sfx","sfx_defeat.mp3"),this.app.fire("UIManager:showUI","Lose Screen"),this.app.fire("UIManager:hideUI","Game Screen"),StatisticsManager.instance.incrementStatistic("statistics_game_lost",1)}.bind(this),1e3):setTimeout(function(){this.reset()}.bind(this),1e3)},addPointToPlayer:function(){var t=pc.setManager.removeEnemyLives();this.app.fire("GameManager:roundCompletePlayer");var e=t<=0;setTimeout(function(){e?(this.sendLevelFinishedStatistic(this.level),this.app.fire("Audio:sfx","sfx_level_victory.mp3"),pc.scoreManager.applyBonus()):this.reset()}.bind(this),1e3)},sendLevelFinishedStatistic:function(t){switch(t){case 1:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_one_wins",1);break;case 2:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_two_wins",1);break;case 3:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_three_wins",1);break;case 4:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_four_wins",1);break;case 5:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_five_wins",1);break;case 6:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_six_wins",1);break;case 7:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_seven_wins",1);break;case 8:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_eight_wins",1);break;case 9:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_nine_wins",1);break;case 10:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_ten_wins",1)}},finishedBonus:function(){setTimeout(function(){var t=window.famobi_analytics.trackEvent(window.famobi_analytics.EVENT_LEVELSUCCESS,{levelName:"level_"+this.level}),e=window.famobi_analytics.trackEvent(window.famobi_analytics.EVENT_TOTALSCORE,{totalScore:pc.scoreManager.score}),i=window.famobi_analytics.trackEvent(window.famobi_analytics.EVENT_CUSTOM,{eventName:"LEVELEND",result:"success",score:pc.scoreManager.score});Promise.all([t,e,i]).then(function(){this.reset();var t=this.increaseLevel();if(t>pc.setManager.getMaxLevel())this.app.fire("UIManager:showUI","Win Screen"),this.app.fire("UIManager:hideUI","Game Screen"),StatisticsManager.instance.incrementStatistic("statistics_game_completed",1),this.switchState(this.states.MENU);else{var e=window.famobi_analytics.trackEvent(window.famobi_analytics.EVENT_LEVELSTART,{levelName:"level_"+pc.gameManager.level});Promise.all([e]).then(()=>{pc.famobiAPI.playerReady();pc.setManager.setLevel(t)})}}.bind(this))}.bind(this),1e3)},switchState:function(t){var e=this.currentState;switch(this.currentState=t,t){case this.states.MENU:this.fullReset(),this.setAllSettings();break;case this.states.START:this.setAllSettings();break;case this.states.GAME:this.isState(this.states.PAUSE,e)||this.isState(this.states.START,e)&&this.start()}},isStarted:function(){return this.isState(this.states.START)},isState:function(t,e){return(e||this.currentState)===t},onUIOpen:function(t){switch(t){case"Game Screen":this.isState(this.states.MENU)&&this.switchState(this.states.START),this.isState(this.states.PAUSE)&&this.switchState(this.states.GAME);break;case"Pause Screen":this.isState(this.states.START)&&this.switchState(this.states.PAUSE);break;case"Lose Screen":case"Win Screen":this.isState(this.states.GAME)&&this.switchState(this.states.END);break;case"Main Menu":this.switchState(this.states.MENU)}},increaseLevel:function(){return this.level+=1,this.app.fire("GameManager:level",this.level),this.level},onKeyDown:function(t){t.key===pc.KEY_R&&this.canSkipLevels&&(this.level+=1,pc.setManager.setLevel(this.level),this.app.fire("GameManager:level",this.level))}});var LocalisationManager=pc.createScript("localisationManager");LocalisationManager.attributes.add("localisationJSON",{type:"asset",assetType:"json"}),LocalisationManager.attributes.add("defaultLanguage",{type:"string",default:"en",title:"Default Language",enum:[{German:"de"},{English:"en"},{Turkish:"tr"},{Polish:"pl"},{Russian:"ru"},{Dutch:"nl"},{Spanish:"es"},{Portuguese:"pt"},{French:"fr"}]}),pc.extend(LocalisationManager.prototype,{postInitialize:function(){pc.localisationManager=this,this._localisations=this.localisationJSON.resource,this._currentLanguage=pc.famobiAPI.getCurrentLanguage(),this._currentLanguage=void 0!==this._localisations[this.currentLanguage]?this.currentLanguage:this.defaultLanguage,this._localisation=this._localisations[this.currentLanguage]},_replaceVariables:function(t,e){if(!Array.isArray(e)||0===e.length)return t;for(var i=t,s=0;s<e.length;s+=1)i=i.replace("{"+s+"}",e[s]);return i},get:function(t,e){return this._replaceVariables(this._localisation[t],e)}});var TweenAlpha=pc.createScript("tweenAlpha");TweenAlpha.attributes.add("initFrom",{type:"number",default:1,title:"From"}),TweenAlpha.attributes.add("initTo",{type:"number",default:0,title:"To"}),TweenAlpha.attributes.add("playStyle",{type:"number",enum:[{Once:0},{Loop:1},{PingPong:2}],title:"Play Style"}),TweenAlpha.attributes.add("duration",{type:"number",default:1,title:"duration"}),TweenAlpha.attributes.add("curve",{type:"curve",title:"Animation Curve"}),TweenAlpha.attributes.add("ignoreTimeScale",{type:"boolean",default:!0,title:"Ignore Time Scale"}),TweenAlpha.attributes.add("startDelay",{type:"number",default:0,title:"Start Delay"}),TweenAlpha.attributes.add("debug",{type:"boolean",default:!1,title:"Show Debug"}),TweenAlpha.attributes.add("startOnEnable",{type:"boolean",default:!0,title:"Start on Enable"}),TweenAlpha.attributes.add("startOnInitialize",{type:"boolean",default:!0,title:"Start on Initialize"}),pc.extend(TweenAlpha.prototype,{initialize:function(){this._time=this.startOnInitialize?0:this.duration+this.startDelay,this._oldTime=this.app._time||0,this._from=this.initFrom,this._to=this.initTo,this._elements=this._elements||[]},postInitialize:function(){this._getAllElementComponents(this.entity),this.startOnInitialize&&this.startTween(),this.on("state",function(t){t&&this.startOnEnable&&this.startTween()})},update:function(t){if(this.isActive()){if(this._updateTime(t),this._time>this.startDelay){var e=this._from-this.curve.value((this._time-this.startDelay)/this.duration)*(this._from-this._to);this.setAllElementOpacity(e),this.debug&&window.famobi.log(this.entity.name,this._time,e)}this._oldTime=this.app._time}if(this._time>=this.duration+this.startDelay)switch(this.playStyle){case 0:break;case 1:this._time=0;break;case 2:this._time=0;var i=this._from;this._from=this._to,this._to=i}},_updateTime:function(t){this._time+=this.ignoreTimeScale?(this.app._time-this._oldTime)/1e3:t},_getAllElementComponents:function(t){var e=t.element;void 0!==e&&null!==e.opacity&&void 0!==e.opacity&&this._elements.push(t.element);var i=this;t.children.forEach(function(t){i._getAllElementComponents(t)})},startTween:function(){this._time=0,this._from=this.initFrom,this._to=this.initTo,this.setAllElementOpacity(this._from),this._oldTime=this.app._time},setAllElementOpacity:function(t){this._elements||(this._elements=[],this._getAllElementComponents(this.entity)),this._elements.forEach(function(e){e.opacity=t})},isActive:function(){return this._time>=0&&this._time<=this.duration+this.startDelay}});var TweenPosition=pc.createScript("tweenPosition");TweenPosition.attributes.add("initFrom",{type:"vec3",default:[0,0,0],title:"From"}),TweenPosition.attributes.add("initTo",{type:"vec3",default:[0,0,0],title:"To"}),TweenPosition.attributes.add("playStyle",{type:"number",enum:[{Once:0},{Loop:1},{PingPong:2}],title:"Play Style"}),TweenPosition.attributes.add("duration",{type:"number",default:1,title:"duration"}),TweenPosition.attributes.add("curve",{type:"curve",title:"Animation Curve"}),TweenPosition.attributes.add("ignoreTimeScale",{type:"boolean",default:!0,title:"Ignore Time Scale"}),TweenPosition.attributes.add("startDelay",{type:"number",default:0,title:"Start Delay"}),TweenPosition.attributes.add("debug",{type:"boolean",default:!1,title:"Show Debug"}),TweenPosition.attributes.add("startAtEnable",{type:"boolean",default:!0,title:"Start on Initialize"}),TweenPosition.attributes.add("startOnEnable",{type:"boolean",default:!0,title:"Start on Enable"}),pc.extend(TweenPosition.prototype,{initialize:function(){this._time=this.startAtEnable?0:-1,this._oldTime=this.app._time||0,this._from=this.initFrom.clone(),this._to=this.initTo.clone()},reset:function(){this._time=this.startAtEnable?0:-1,this._oldTime=this.app._time||0,this._from=this.initFrom.clone(),this._to=this.initTo.clone(),this._initPosition=this.entity.getLocalPosition().clone(),this._newPosition=new pc.Vec3(0,0,0)},postInitialize:function(){this._initPosition=this.entity.getLocalPosition().clone(),this._newPosition=new pc.Vec3(0,0,0),this.on("state",function(t){t&&this.startOnEnable}),this.startAtEnable},update:function(t){if(this._time>=0&&this._time<=this.duration+this.startDelay&&(this.updateTime(t),this._time>this.startDelay&&(this._newPosition.set(this._from.x,this._from.y,this._from.z).sub(this._to).scale(this.curve.value((this._time-this.startDelay)/this.duration)).sub2(this._from,this._newPosition).add(this._initPosition),this.debug&&window.famobi.log(this._time,this.entity.getLocalPosition().toString(),this.entity),this.entity.setLocalPosition(this._newPosition)),this._oldTime=this.app._time),this._time>=this.duration+this.startDelay)switch(this.playStyle){case 0:break;case 1:this._time=0;break;case 2:this._time=0;var e=this._from;this._from=this._to,this._to=e}},setPosition:function(t,e){this.initFrom=t.clone(),this.initTo=e.clone()},updateTime:function(t){this._time+=this.ignoreTimeScale?(this.app._time-this._oldTime)/1e3:t},moveTo:function(t,e){this._time=0,this._from.set(0,0,0),this._to.set(0,0,0),this._to.sub(t),this._initPosition.set(t.x,t.y,t.z),this._oldTime=this.app._time},startTween:function(){this._time=0,this._from.set(this.initFrom.x,this.initFrom.y,this.initFrom.z),this._to.set(this.initTo.x,this.initTo.y,this.initTo.z),this.entity.setLocalPosition(this._from.x+this._initPosition.x,this._from.y+this._initPosition.y,this._from.z+this._initPosition.z),this._oldTime=this.app._time},stopTween:function(){this._time=-1}});var TweenRotation=pc.createScript("tweenRotation");TweenRotation.attributes.add("initFrom",{type:"vec3",default:[0,0,0],title:"From"}),TweenRotation.attributes.add("initTo",{type:"vec3",default:[0,0,0],title:"To"}),TweenRotation.attributes.add("playStyle",{type:"number",enum:[{Once:0},{Loop:1},{PingPong:2}],title:"Play Style"}),TweenRotation.attributes.add("duration",{type:"number",default:1,title:"duration"}),TweenRotation.attributes.add("curve",{type:"curve",title:"Animation Curve"}),TweenRotation.attributes.add("ignoreTimeScale",{type:"boolean",default:!0,title:"Ignore Time Scale"}),TweenRotation.attributes.add("startDelay",{type:"number",default:0,title:"Start Delay"}),TweenRotation.attributes.add("debug",{type:"boolean",default:!1,title:"Show Debug"}),TweenRotation.attributes.add("startOnEnable",{type:"boolean",default:!0,title:"Start on Enable"}),TweenRotation.attributes.add("startOnInit",{type:"boolean",default:!0,title:"Start on Initialize"}),pc.extend(TweenRotation.prototype,{initialize:function(){this._time=this.startOnInit?0:this.duration+this.startDelay+1,this._oldTime=this.app._time||0,this._from=this.initFrom.clone(),this._to=this.initTo.clone()},postInitialize:function(){this._initRotation=this.entity.getLocalEulerAngles(),this._newRotation=new pc.Vec3(0,0,0),this.on("state",function(t){t&&this.startOnEnable&&this.startTween()}),this.startOnInit&&(pc.util.EXPLICIT&&window.famobi.log("start tweening"),this.startTween())},update:function(t){if(this._time>=0&&this._time<=this.duration+this.startDelay&&(this._updateTime(t),this._time>this.startDelay&&(this._newRotation.set(this._from.x,this._from.y,this._from.z).sub(this._to).scale(this.curve.value((this._time-this.startDelay)/this.duration)).sub2(this._from,this._newRotation).add(this._initRotation),this.debug&&window.famobi.log(this.time,newRotation.toString()),this.entity.setLocalEulerAngles(this._newRotation.x,this._newRotation.y,this._newRotation.z)),this._oldTime=this.app._time),this._time>=this.duration+this.startDelay||this._time<=0)switch(this.playStyle){case 0:break;case 1:this._time=0;break;case 2:this._time=0;var e=this._from;this._from=this._to,this._to=e}},_updateTime:function(t){this._time+=this.ignoreTimeScale?(this.app._time-this._oldTime)/1e3:t},setInitRotation:function(t,e,i){this.entity.setLocalEulerAngles(t,e,i),this._initRotation.set(this.entity.getLocalEulerAngles().x,this.entity.getLocalEulerAngles().y,this.entity.getLocalEulerAngles().z)},startTween:function(){this._time=0,this._from.set(this.initFrom.x,this.initFrom.y,this.initFrom.z),this._to.set(this.initTo.x,this.initTo.y,this.initTo.z),this.entity.setLocalEulerAngles(this._from.x,this._from.y,this._from.z),this._oldTime=this.app._time}});var TweenScale=pc.createScript("tweenScale");TweenScale.attributes.add("initFrom",{type:"vec3",default:[0,0,0],title:"From"}),TweenScale.attributes.add("initTo",{type:"vec3",default:[0,0,0],title:"To"}),TweenScale.attributes.add("playStyle",{type:"number",enum:[{Once:0},{Loop:1},{PingPong:2}],title:"Play Style"}),TweenScale.attributes.add("duration",{type:"number",default:1,title:"duration"}),TweenScale.attributes.add("curve",{type:"curve",title:"Animation Curve"}),TweenScale.attributes.add("ignoreTimeScale",{type:"boolean",default:!0,title:"Ignore Time Scale"}),TweenScale.attributes.add("startDelay",{type:"number",default:0,title:"Start Delay"}),TweenScale.attributes.add("debug",{type:"boolean",default:!1,title:"Show Debug"}),TweenScale.attributes.add("startOnEnable",{type:"boolean",default:!0,title:"Start on Enable"}),TweenScale.attributes.add("startOnInit",{type:"boolean",default:!0,title:"Start on Initialize"}),pc.extend(TweenScale.prototype,{initialize:function(){this._time=this.startAtEnable?0:this.duration+this.startDelay+1,this._oldTime=this.app._time||0,this._from=this.initFrom,this._to=this.initTo,this._temp=new pc.Vec3(0,0,0),this._newScale=new pc.Vec3(0,0,0)},postInitialize:function(){this._initScale=this.entity.getLocalScale().clone(),this.on("state",function(t){t&&this.startOnEnable&&this.startTween()}),this.startOnInit&&this.startTween()},update:function(t){if(this._time>=0&&this._time<=this.duration+this.startDelay&&(this._updateTime(t),this._time>this.startDelay&&(this._newScale.set(this._from.x,this._from.y,this._from.z).sub(this._to).scale(this.curve.value((this._time-this.startDelay)/this.duration)).sub2(this._from,this._newScale).mul(this._initScale),this.debug&&window.famobi.log(this._time,newScale.toString()),this.entity.setLocalScale(this._newScale.x,this._newScale.y,this._newScale.z)),this._oldTime=this.app._time),this._time>=this.duration+this.startDelay||this._time<=0)switch(this.playStyle){case 0:break;case 1:this._time=0;break;case 2:this._time=0,this._temp.set(this._from.x,this._from.y,this._from.z),this._from.set(this._to.x,this._to.y,this._to.z),this._to.set(this._temp.x,this._temp.y,this._temp.z)}},_updateTime:function(t){this._time+=this.ignoreTimeScale?(this.app._time-this._oldTime)/1e3:t},startTween:function(){this._time=0,this._from.set(this.initFrom.x,this.initFrom.y,this.initFrom.z),this._to.set(this.initTo.x,this.initTo.y,this.initTo.z),this.entity.setLocalScale(this._from.x*this._initScale.x,this._from.y*this._initScale.y,this._from.z*this._initScale.z),this._oldTime=this.app._time}});var LevelLoader=pc.createScript("levelLoader");LevelLoader.attributes.add("levelKey",{type:"string",default:"level"}),pc.extend(LevelLoader.prototype,{initialize:function(){pc.levelLoader=this},loadLevel:function(t,e,i){var s=this.app.assets.find("level-"+t+".json");pc.lazyLoader.lazyLoad(s,e,i)},lazyLoadLevels:function(){for(var t=this.app.assets.findByTag("level"),e=0,i=t.length,s=function(){(e+=1)===i&&window.famobi.log("All levels loaded.")},n=0;n<t.length;n+=1)t[n].resource?s():pc.lazyLoader.lazyLoad(asset)}});var StorageManager=pc.createScript("storageManager");StorageManager.attributes.add("defaultSaveData",{type:"asset",assetType:"json"}),pc.extend(StorageManager.prototype,{initialize:function(){pc.storageManager=this,this._basicInfo=this.defaultSaveData.resource,this._storages=Object.freeze({LOCALSTORAGE:"LOCALSTORAGE",SESSIONSTORAGE:"SESSIONSTORAGE"}),this._localStorage={},this._sessionStorage={},this.loadSaveData()},get:function(t,e){switch((e=e||"LOCALSTORAGE").toUpperCase()){case this._storages.LOCALSTORAGE:return this._localStorage[t];case this._storages.SESSIONSTORAGE:return this._sessionStorage[t];default:return console.warn("Storage is "+e+", which is incorrect."),null}},set:function(t,e,i,s){if(s=s||"localStorage",i=i||!1){var n=this.get(t);if("number"==typeof e)if(e<=n)return}this._writeToStorage(t,e,s)},remove:function(t,e){switch(this._getStorage(e)[t]=this._basicInfo[t],e.toUpperCase()){case this._storages.LOCALSTORAGE:pc.famobiAPI.removeLocalStorageItem(t);break;case this._storages.SESSIONSTORAGE:pc.famobiAPI.removeSessionStorageItem(t);break;default:console.warn("Storage is not recognized.","Key is "+t)}},delete:function(t){this._getStorage(t);switch(this._basicInfo,t.toUpperCase()){case this._storages.LOCALSTORAGE:pc.famobiAPI.clearLocalStorage();break;case this._storages.SESSIONSTORAGE:pc.famobiAPI.clearSessionStorage();break;default:console.warn("Storage is not recognized.")}},_writeToStorage:function(t,e,i){switch(this._getStorage(i)[t]=e,i.toUpperCase()){case this._storages.LOCALSTORAGE:pc.famobiAPI.setLocalStorageItem(t,JSON.stringify(e));break;case this._storages.SESSIONSTORAGE:pc.famobiAPI.setSessionStorageItem(t,JSON.stringify(e));break;default:console.warn("Storage is not recognized.","Key is "+t)}},_getStorage:function(t){switch(t.toUpperCase()){case this._storages.LOCALSTORAGE:case this._storages.SESSIONSTORAGE:return this._localStorage;default:return console.warn("Storage "+t+" not found"),null}},loadSaveData:function(){for(var t=Object.keys(this._basicInfo),e=0;e<t.length;e+=1){var i=t[e],s=pc.famobiAPI.getLocalStorageItem(i);try{this._localStorage[i]=JSON.parse(s)}catch(t){this._localStorage[i]=s}void 0!==this._localStorage[i]&&null!==this._localStorage[i]||(this._localStorage[i]=this._basicInfo[i],this.set(i,this._localStorage[i])),Array.isArray(this._basicInfo[i])&&!Array.isArray(this._localStorage[i])&&(this._localStorage[i]=this._basicInfo[i],this.set(i,this._localStorage[i])),typeof this._localStorage[i]!=typeof this._basicInfo[i]&&(this._localStorage[i]=this._basicInfo[i],this.set(i,this._localStorage[i]))}}});var VibrationManager=pc.createScript("vibrationManager");pc.extend(VibrationManager.prototype,{initialize:function(){pc.vibrationManager=this,navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,this._isSupported=!!navigator.vibrate,this._defaultVibration=[100,10,100]},postInitialize:function(){this._vibration=pc.storageManager.get("vibrate"),navigator.vibrate?this.app.on("vibrate",this._vibrate,this):this.enabled=!1},_vibrate:function(t){navigator.vibrate||console.warn("Vibration not supported"),this._vibration&&navigator.vibrate(t||this._defaultVibration)},_save:function(){pc.storageManager.set("vibrate",this._vibration)},get:function(){return this._vibration},set:function(t){this._vibration=t,this._save()},toggle:function(){return this._vibration=!this._vibration,this.save(),this._vibration},isVibrationSupported:function(){return this._isSupported&&pc.platform.mobile}});var LazyLoader=pc.createScript("lazyLoader");pc.extend(LazyLoader.prototype,{initialize:function(){pc.lazyLoader=this,this.app.loader.getHandler("texture").crossOrigin="anonymous"},lazyLoad:function(t,e,i){if(t)if(t.resource)e&&e.call(i,t);else{t.once("load",function(){setTimeout(function(){e&&e.call(i,t)})}),this.app.assets.load(t)}else console.warn("Asset is undefined")}});var UIManager=pc.createScript("uiManager");UIManager.attributes.add("loadingOverlay",{type:"entity"}),pc.extend(UIManager.prototype,{initialize:function(){pc.uiManager=this,this._stackScreen=[],this._stackOverlay=[],this._stackPopup=[],this._uiTypes=["Screen","Overlay","Popup"],this._uis={},this.app.once("GameManager:ready",this._removeLoadingOverlay,this),this.app.on("UIManager:showUI",this._showUI,this),this.app.on("UIManager:hideUI",this._hideUI,this)},enableChildrens:function(){for(var t=0;t<this.entity.children.length;t+=1){var e=this.entity.children[t];e instanceof pc.Entity&&(e.script.uiEntity?e.enabled||(e.enabled=!0,window.famobi.log(e.name,"was disabled. Turned it back on.")):window.famobi.log(e.name,"has no uiEntity script",e))}},addUIEntity:function(t,e,i,s){-1!==this._uiTypes.indexOf(e)?("string"==typeof t&&t||console.warn("Name is invalid",t),this._uis[t]?console.warn("This ui name is already occupied.",t):(this._uis[t]={entity:i,type:e},s?this._showUI(t,!0):this._hideUI(t,!0))):console.warn("Type is not recognize",e)},_removeLoadingOverlay:function(){this.loadingOverlay instanceof pc.Entity&&this.loadingOverlay.destroy()},_showUI:function(t,e){var i=this._uis[t];i?!i.entity.enabled||e?(i.entity.script.uiEntity.onOpen(),this._addToStack(i.entity,i.type,e),this.app.fire("UIManager:uiOpened",t)):console.warn("UI is already enabled",t):console.warn("No ui is found with the name",t)},_hideUI:function(t,e){var i=this._uis[t];i?i.entity.enabled||e?(i.entity.script.uiEntity.onClose(),this._removeFromStack(i.entity,i.type,e)):console.warn("UI is already disabled",t):console.warn("No ui is found with the name",t)},_addToStack:function(t,e,i){var s=this._getStack(e),n=s.indexOf(t);-1!==n&&(window.famobi.log("Entity is already in the stack, pushed to the top",t),s.splice(n,1)),s.push(t)},_removeFromStack:function(t,e,i){if(!i){var s=this._getStack(e),n=s.indexOf(t);-1!==n?s.splice(n,1):console.warn("Entity doesn't exist in the stack",s,t)}},_getStack:function(t){return this["_stack"+t]},getReferenceResolution:function(){return this.entity.screen.referenceResolution},getScale:function(){return this.entity.screen._updateScale(),this.entity.screen.scale}});var UIEntity=pc.createScript("uiEntity");UIEntity.attributes.add("name",{type:"string",default:""}),UIEntity.attributes.add("type",{type:"string",enum:[{Screen:"Screen"},{Overlay:"Overlay"},{Popup:"Popup"}]}),UIEntity.attributes.add("scriptName",{type:"string",default:""}),UIEntity.attributes.add("showOnStartUp",{type:"boolean",default:!1}),pc.extend(UIEntity.prototype,{postInitialize:function(){pc.uiManager.addUIEntity(this.name,this.type,this.entity,this.showOnStartUp)},onClose:function(){return this.entity.enabled=!1,!!this.scriptName&&(this.entity.script[this.scriptName]instanceof pc.script.__proto__.constructor?"function"!=typeof this.entity.script[this.scriptName].onUIEntityClose?(window.famobi.log("No close function is not found",this.scriptName),!1):(this.entity.script[this.scriptName].onUIEntityClose(),!0):(console.warn(this.scriptName,"is not a valid script."),!1))},onOpen:function(){this.entity.enabled=!0,this.scriptName&&(this.entity.script[this.scriptName]instanceof pc.script.__proto__.constructor?"function"==typeof this.entity.script[this.scriptName].onUIEntityOpen?this.entity.script[this.scriptName].onUIEntityOpen():window.famobi.log("No open function is not found",this.scriptName):console.warn(this.scriptName,"is not a valid script."))}});var ObjectPool=pc.createScript("objectPool");ObjectPool.attributes.add("templateEntity",{type:"entity",title:"Template Entity"}),ObjectPool.attributes.add("initialLength",{type:"number",default:16}),ObjectPool.attributes.add("growCount",{type:"number",default:5}),ObjectPool.attributes.add("disableOnInit",{type:"boolean",default:!0,title:"Disable on Init"});var EMPTY_SLOT=Object.freeze(Object.create(null));pc.extend(ObjectPool.prototype,{initialize:function(){this._pool=[],this._nextFreeSlot=null,this.templateEntity?this._grow(this.initialLength):console.warn("ObjectPool: template is null (aborting initialization...)")},_grow:function(t){if(t>0&&null===this._nextFreeSlot&&(this._nextFreeSlot=0),t>0){var e=this._pool.length;this._pool.length+=Number(t);for(var i=e;i<this._pool.length;i+=1){var s=this.templateEntity.clone();s.reparent(this.entity),this._pool[i]=s,this.disableOnInit&&(s.enabled=!1)}}return this._pool.length},use:function(){null!==this._nextFreeSlot&&this._nextFreeSlot!==this._pool.length||this._grow(this.growCount);var t=this._pool[this._nextFreeSlot];return this._pool[this._nextFreeSlot]=EMPTY_SLOT,this._nextFreeSlot+=1,t},recycle:function(t){null===this._nextFreeSlot||-1===this._nextFreeSlot?this._pool[this._pool.length]=t:this._pool[this._nextFreeSlot-=1]=t},size:function(){return this._pool.length}});var SwitchUibutton=pc.createScript("switchUibutton");SwitchUibutton.attributes.add("openUIEntity",{type:"entity",array:!0,title:"Open UI Entities"}),SwitchUibutton.attributes.add("closeItself",{type:"boolean",default:!1,title:"Close current UI Entity"}),SwitchUibutton.attributes.add("closeUIEntity",{type:"entity",array:!0,title:"Close other UI Entities"}),SwitchUibutton.attributes.add("touchType",{type:"number",enum:[{"TOUCH-END":0},{"TOUCH-START":1}],default:0}),pc.extend(SwitchUibutton.prototype,{initialize:function(){var t=this;if(this.activated=!0,this.entity.button&&this.on("enable",function(){t.entity.button._isHovering=!1}),this.app.touch&&(0===this.touchType?this.entity.element.on("touchend",this._onInputUp,this):this.entity.element.on("touchstart",this._onInputUp,this)),this.app.mouse&&this.entity.element.on("mouseup",this._onInputUp,this),this.closeItself){var e=this._getUIEntity(this.entity,4);e instanceof pc.Entity?this.closeUIEntity.push(e):console.warn("Couldn't find a UI Entity")}},_getUIEntity:function(t,e){return e<=0&&!(t instanceof pc.Entity)?null:t.script&&t.script.uiEntity instanceof pc.script.__proto__.constructor?t:this._getUIEntity(t.parent,e-=1)},_onInputUp:function(t){this.fire("click"),this.app.fire("Audio:sfx","sfx_button.mp3"),this.activated&&this.changeUIEntities()},changeUIEntities:function(){this._openEntities(),this._closeEntities()},_openEntities:function(){for(var t=0;t<this.openUIEntity.length;t+=1)this.openUIEntity[t]instanceof pc.Entity?this.app.fire("UIManager:showUI",this.openUIEntity[t].script.uiEntity.name):console.warn(this.entity.parent.name,"has in invalid parameter in the array openUIEntity with index",t)},_closeEntities:function(){for(var t=0;t<this.closeUIEntity.length;t+=1)this.closeUIEntity[t]instanceof pc.Entity?this.app.fire("UIManager:hideUI",this.closeUIEntity[t].script.uiEntity.name):console.warn(this.entity.parent.name,"has in invalid parameter in the array closeUIEntity with index",t)},deactivate:function(){this.activated=!1}});var BallMovement=pc.createScript("ballMovement");BallMovement.attributes.add("moveSpeed",{type:"number",default:11,title:"Movement Speed"}),BallMovement.attributes.add("maxSpeed",{type:"number",default:36,title:"Max Speed"}),BallMovement.attributes.add("curveFactor",{type:"number",default:.6,title:"Curve Factor"}),BallMovement.attributes.add("speedIncreaseOnHit",{type:"number",default:1,title:"Speed Incremental On Hit"}),BallMovement.attributes.add("minCurve",{type:"number",default:.35,title:"Min Curve"}),BallMovement.attributes.add("maxCurve",{type:"number",default:1.1,title:"Max Curve"}),BallMovement.attributes.add("startPosition",{type:"vec3",default:[0,0,9.9],title:"Start Position"}),BallMovement.attributes.add("accuracyRadius",{type:"number",default:.1,title:"Accuracy Radius"}),BallMovement.attributes.add("velocityOnHit",{type:"vec2",default:[.5,.5],title:"Velocity On Hit"}),BallMovement.attributes.add("goalLayers",{type:"number",array:!0,title:"Goal Layers"}),BallMovement.attributes.add("normalLayer",{type:"number",default:1002,title:"Normal Layer"}),BallMovement.attributes.add("quadrantFactor",{type:"number",default:1,title:"Quadrant Factor"}),BallMovement.attributes.add("minimalQuadrantHit",{type:"vec2",default:[.1,.1],title:"Min Quadrant Hit"}),BallMovement.attributes.add("ballSpinFactor",{type:"number",default:1,title:"Ball Spin Factor"}),BallMovement.attributes.add("ballSpinDampFactor",{type:"number",default:.5,title:"Ball Spin Damp Factor"}),BallMovement.attributes.add("enemyHasCurve",{type:"boolean",default:!1,title:"Enemy Has Curve"}),pc.extend(BallMovement.prototype,{initialize:function(){this._rigidbody=this.entity.rigidbody,this._moving=!1,this._playerBounce=!1,this._linearVelocity=new pc.Vec3,this._quadrant=new pc.Vec2,this.curving=!1,this.moved=!1,this.movementX=0,this.movementY=0,this.app.on("GameManager:reset",this.reset,this),this.ballSpinForce=new pc.Vec3,this.app.on("GameManager:fullReset",this.onFullReset,this),this.entity.collision.on("collisionstart",this.onWallCollision,this),this.audioLength=8,this.ballTimer=0,this.ballTimerReset=.1},update:function(t){if(pc.gameManager.isStarted&&this.moved){this.ballTimer>0&&(this.ballTimer-=t);var e=Math.abs(this._rigidbody.linearVelocity.z),i=pc.math.clamp(e,this.moveSpeed,Number.POSITIVE_INFINITY);(e!==i||e!==(i=pc.math.clamp(e,Number.NEGATIVE_INFINITY,this.maxSpeed)))&&this.setLinearVelocity(this._rigidbody.linearVelocity.x,this._rigidbody.linearVelocity.y,i*Math.sign(this._rigidbody.linearVelocity.z)),this.curving&&this._rigidbody.applyImpulse(this.movementX*e*t,this.movementY*e*t,0)}},onWallCollision:function(t){t.other.tags.has("wall")&&this.playRandomBounce(3)},playRandomBounce:function(t){this.ballTimer<=0&&(this.app.fire("Audio:sfx","sfx_ball_bounce"+t+".mp3"),this.ballTimer=this.ballTimerReset)},onCollisionStart:function(t){if(this.moved&&(this.setLinearVelocity(this._rigidbody.linearVelocity.x,this._rigidbody.linearVelocity.y,-this._rigidbody.linearVelocity.z),t.tags.has("bat"))){this.app.fire("vibrate",5);var e=this.speedIncreaseOnHit,i=this.getQuadrant(t),s=this.isAccuracyHit(t);if(t.tags.has("player")){this.playRandomBounce(1),pc.scoreManager.addHitBonus(),e=-this.speedIncreaseOnHit;var n=t.script.playerBat.getVelocity();n.length();this.movementX=-this.clampCurve(n.x)*this.curveFactor,this.movementY=-this.clampCurve(n.y)*this.curveFactor,t.script.playerBat.setQuadrant(i,s),s&&(StatisticsManager.instance.incrementStatistic("statistics_amount_of_center_hits",1),pc.scoreManager.addAccuracyBonus()),this.curving=!0;var a=Math.abs(n.length()),o=a>=this.minCurve,r=a>=this.maxCurve,h=this.ballSpinForce;h.set(this.movementY,this.movementX,0).scale(-1*this.ballSpinFactor),this.dampAngularVelocity(),this._rigidbody.applyTorqueImpulse(h),r?(StatisticsManager.instance.incrementStatistic("statistics_amount_of_super_curve_balls",1),pc.scoreManager.addSuperCurveBonus(),this.entity.script.ballColor.changeParticleSystem(!0)):o?(StatisticsManager.instance.incrementStatistic("statistics_amount_of_curve_balls",1),pc.scoreManager.addCurveBonus(),this.entity.script.ballColor.changeParticleSystem(!0)):this.dampAngularVelocity()}if(t.tags.has("enemy")&&(this.playRandomBounce(2),this.entity.script.ballColor.changeParticleSystem(!1),!this.enemyHasCurve)){this.curving=!1,t.script.enemyBat.setQuadrant(i,s);var c=t.script.enemyBat.getVelocity();c.length();this.movementX=-this.clampCurve(c.x)*this.curveFactor,this.movementY=-this.clampCurve(c.y)*this.curveFactor}this.applyImpulse(i.x*this.quadrantFactor*this.velocityOnHit.x,i.y*this.quadrantFactor*this.velocityOnHit.y,e)}},clampCurve:function(t){var e=Math.sign(t);return pc.math.clamp(Math.abs(t),0,this.maxCurve)*e},dampAngularVelocity:function(){this._rigidbody.angularVelocity=this._rigidbody.angularVelocity.scale(this.ballSpinDampFactor)},applyImpulse:function(t,e,i){this._rigidbody.applyImpulse(t,e,i)},maxSpeedReached:function(){return this._rigidbody.linearVelocity.z>this.maxSpeed||this._rigidbody.linearVelocity.z<-this.maxSpeed},reset:function(){this._rigidbody.teleport(this.startPosition.x,this.startPosition.y,this.startPosition.z),this._rigidbody.enabled=!1,this.ballTimer=0,this.moved=!1,this.hit=!1,this.setLinearVelocity(0,0,0),this.entity.setLocalEulerAngles(new pc.Vec3(0,0,0)),this._rigidbody.angularVelocity=new pc.Vec3(0,0,0),this._setLayer(this.normalLayer),this.stopCurving()},start:function(t){return!(this.moved||!this.batOverlaps(t)||this.hit)&&(StatisticsManager.instance.incrementStatistic("statistics_amount_of_player_hits",1),pc.gameManager.start(),this.moved=!0,this._rigidbody.enabled=!0,this.setLinearVelocity(0,0,this.moveSpeed),this.onCollisionStart(t),!0)},batOverlaps:function(t){return t.script.collider.intersect(this.entity)},getQuadrant:function(t){var e=this.entity.getPosition().x-t.getPosition().x,i=this.entity.getPosition().y-t.getPosition().y;return e=pc.math.clamp(Math.abs(e),this.minimalQuadrantHit.x,Number.POSITIVE_INFINITY)*Math.sign(e),i=pc.math.clamp(Math.abs(i),this.minimalQuadrantHit.y,Number.POSITIVE_INFINITY)*Math.sign(i),this._quadrant.set(e,i),this._quadrant},isAccuracyHit:function(t){var e=t.getPosition().x-this.entity.getPosition().x,i=t.getPosition().y-this.entity.getPosition().y;return Math.sqrt(e*e+i*i)<=this.accuracyRadius},setLinearVelocity:function(t,e,i){this._linearVelocity.set(t,e,i),this._rigidbody.linearVelocity=this._linearVelocity},stopCurving:function(){this.curving=!1},setDifficultySettings:function(t,e,i,s,n){this.moveSpeed=t,this.maxSpeed=e,this.minCurve=i,this.maxCurve=s,this.speedIncreaseOnHit=n,this.entity.script.ballColor.setSpeed(this.moveSpeed)},hitGoal:function(t){this._rigidbody.enabled=!1,this.moved=!1,this.hit=!0,this._setLayer(this.goalLayers[t])},shouldEnemyChase:function(){return this.moved&&this._rigidbody.linearVelocity.z<0},_setLayer:function(t){this.entity.model.layers=[t]},onFullReset:function(){},changeLightColor:function(){this.entity.light.color=this.entity.model.model.meshInstances[0].material.diffuse},playerWin:function(){this.changeColor(this.ballColorDefeated)},enemyWin:function(){this.changeColor(this.ballColorWin),this.entity.enabled=!1}});var ContinuousCollisionDetection=pc.createScript("continuousCollisionDetection");ContinuousCollisionDetection.attributes.add("motionThreshold",{type:"number",default:1,title:"Motion Threshold",description:"Number of meters moved in one frame before CCD is enabled"}),ContinuousCollisionDetection.attributes.add("sweptSphereRadius",{type:"number",default:.2,title:"Swept Sphere Radius",description:"This should be below the half extent of the collision volume. E.g For an object of dimensions 1 meter, try 0.2"}),pc.extend(ContinuousCollisionDetection.prototype,{initialize:function(){var t;(t=this.entity.rigidbody.body).setCcdMotionThreshold(this.motionThreshold),t.setCcdSweptSphereRadius(this.sweptSphereRadius),this.on("attr:motionThreshold",function(e,i){(t=this.entity.rigidbody.body).setCcdMotionThreshold(e)}),this.on("attr:sweptSphereRadius",function(e,i){(t=this.entity.rigidbody.body).setCcdSweptSphereRadius(e)})}});var LineIndicator=pc.createScript("lineIndicator");LineIndicator.attributes.add("entityToTrack",{type:"entity"}),LineIndicator.attributes.add("clamp",{type:"vec2",default:[-10,10]}),LineIndicator.attributes.add("baseLineColor",{type:"rgb",default:[1,0,1]}),LineIndicator.attributes.add("lineColorPlayerScore",{type:"rgb",default:[1,0,1]}),LineIndicator.attributes.add("lineColorEnemyScore",{type:"rgb",default:[1,0,1]}),pc.extend(LineIndicator.prototype,{initialize:function(){this.app.on("GameManager:fullReset",this.onFullReset,this),this.app.on("GameManager:start",this.onStart,this),this.app.on("GameManager:level",this.onLevelChange,this),this.app.on("GameManager:roundCompleteEnemy",this.playerWin,this),this.app.on("GameManager:roundCompletePlayer",this.enemyWin,this),this.app.on("GameManager:reset",this.reset,this),this.meshInstances=[],this.pushToInstances()},update:function(){var t=pc.math.clamp(this.entityToTrack.getPosition().z,this.clamp.x,this.clamp.y);this.entity.setPosition(this.entity.getPosition().x,this.entity.getPosition().y,t)},onFullReset:function(){this.entity.enabled=!1},onStart:function(){this.entity.enabled||(this.entity.enabled=!0)},onLevelChange:function(){this.entity.enabled=!1},playerWin:function(){pc.lightManager.startPulse(this.lineColorEnemyScore,this.baseLineColor,this.meshInstances)},enemyWin:function(){pc.lightManager.startPulse(this.lineColorPlayerScore,this.baseLineColor,this.meshInstances)},reset:function(){this.changeColor(this.baseLineColor)},pushToInstances:function(){for(var t=this.entity.children.length,e=0;e<t;e+=1)this.meshInstances.push(this.entity.children[e].model.model.meshInstances[0])},changeColor:function(t){for(var e=this.entity.children.length,i=0;i<e;i+=1)this.entity.children[i].model.model.meshInstances[0].material.emissive=t,this.entity.children[i].model.model.meshInstances[0].material.diffuse=t,this.entity.children[i].model.model.meshInstances[0].material.update()}});var InputBehaviour=pc.createScript("inputBehaviour");InputBehaviour.attributes.add("mobileInputOffset",{type:"number",default:75}),pc.extend(InputBehaviour.prototype,{initialize:function(){this._player=pc.gameManager.getPlayerBat(),this._ball=pc.gameManager.getBall();var t=this.app.mouse,e=this.app.touch;this._startPosition=new pc.Vec2,this._started=!1,this.touchAvailable=!1,this.app.on("GameManager:reset",this.reset,this),e&&(this.entity.element.on("touchstart",this.onTouchStart,this),this.entity.element.on("touchmove",this.onTouchMove,this),this.touchAvailable=!0),t&&(this.entity.element.on("mousedown",this.onMouseDown,this),this.entity.element.on("mousemove",this.onMouseMove,this),t.disableContextMenu())},postInitialize:function(){this.touchAvailable&&this._player.script.playerBat.onMove(new pc.Vec2(150,75))},onMouseMove:function(t){var e=this.app.touch?this.mobileInputOffset:0;this._startPosition.set(t.x,t.y-e),this._player.script.playerBat.onMove(this._startPosition)},onTouchMove:function(t){this.onTouchStart(t);var e=void 0===typeof t.touches[0].clientX?t.touches[0].screenX-273:t.touches[0].clientX,i=void 0===typeof t.touches[0].clientY?t.touches[0].screenY-273:t.touches[0].clientY;this._startPosition.set(e,i-this.mobileInputOffset),this._player.script.playerBat.onMove(this._startPosition)},onMouseDown:function(t){if(this._started)return!1;this._started=this._ball.script.ballMovement.start(this._player),this.setToStart()},onTouchStart:function(t){if(this._started)return!1;var e=void 0===typeof t.touches[0].clientX?t.touches[0].screenX-273:t.touches[0].clientX,i=void 0===typeof t.touches[0].clientY?t.touches[0].screenY-273:t.touches[0].clientY;this._startPosition.set(e,i-this.mobileInputOffset),this._player.script.playerBat.onMove(this._startPosition),this._started=this._ball.script.ballMovement.start(this._player),this.setToStart()},reset:function(){this._started=!1},setToStart:function(){this._started&&pc.gameManager.switchState(pc.gameManager.states.GAME)}});var Goal=pc.createScript("goal");Goal.attributes.add("type",{type:"number",enum:[{Player:0},{Enemy:1}]}),Goal.attributes.add("bat",{type:"entity"}),pc.extend(Goal.prototype,{initialize:function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},onTriggerEnter:function(t){if(t.tags.has("ball")){var e=t.script.ballMovement;switch(this.type){case 0:e.batOverlaps(this.bat)?(e.onCollisionStart(this.bat),StatisticsManager.instance.incrementStatistic("statistics_amount_of_player_hits",1)):(e.hitGoal(0),this.app.fire("Audio:sfx","sfx_goal.mp3"),pc.gameManager.addPointToEnemy());break;case 1:e.batOverlaps(this.bat)?e.onCollisionStart(this.bat):(e.hitGoal(1),this.app.fire("Audio:sfx","sfx_goal.mp3"),pc.gameManager.addPointToPlayer(),StatisticsManager.instance.incrementStatistic("statistics_amount_of_goals_hits",1));break;default:window.famobi.log(this.type,"doesn't exists")}}}});var SetManager=pc.createScript("setManager");SetManager.attributes.add("playerLives",{type:"number",default:5}),SetManager.attributes.add("setData",{type:"asset",assetType:"json"}),pc.extend(SetManager.prototype,{initialize:function(){pc.setManager=this,this.sets=this.setData.resource,this.currentSet=null,this.level=0,this._maxLevel=10,pc.gameManager.forcedMode&&"number"==typeof pc.gameManager.forcedModeProperties.override.player_lives&&(this.playerLives=pc.gameManager.forcedModeProperties.override.player_lives),this._playerLives=this.playerLives,this._ball=pc.gameManager.getBall(),this._enemy=pc.gameManager.getEnemyBat(),this._enemyLives=0},getMaxLevel:function(){return this._maxLevel},setLevel:function(t){this.level=t;var e=this.getCurrentSetData();return this.sendLevelStartStatistic(this.level),!!e&&(this.app.fire("SetManager:enemyLives",this._enemyLives),this.app.fire("SetManager:playerLives",this._playerLives),!0)},getCurrentSetData:function(){return this.currentSet=this.sets["level_"+this.level],this.currentSet?(this._enemyLives=pc.gameManager.forcedMode&&pc.gameManager.forcedModeProperties.override.enemy_lives||this.currentSet.lives,this._ball.script.ballMovement.setDifficultySettings(this.currentSet.ballSpeed,this.currentSet.maxSpeedBall,this.currentSet.minCurveBall,this.currentSet.maxCurveBall,this.currentSet.speedIncreaseOnHitBall),this._enemy.script.enemyBat.setDifficultySettings(this.currentSet.enemyReactionSpeed,this.currentSet.enemyMovementSpeed),!0):(console.warn("No set data is found for level",this.level),!1)},sendLevelStartStatistic:function(t){switch(t){case 2:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_two_starts",1);break;case 3:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_three_starts",1);break;case 4:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_four_starts",1);break;case 5:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_five_starts",1);break;case 6:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_six_starts",1);break;case 7:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_seven_starts",1);break;case 8:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_eight_starts",1);break;case 9:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_nine_starts",1);break;case 10:StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_ten_starts",1)}},removeEnemyLives:function(t){return this._enemyLives-=t||1,this.app.fire("SetManager:enemyLives",this._enemyLives),this._enemyLives,this._enemyLives},removePlayerLives:function(t){return this._playerLives-=t||1,this.app.fire("SetManager:playerLives",this._playerLives),this.playerLives,this._playerLives},resetPlayerLives:function(){this._enemyLives=0,this._playerLives=this.playerLives,this.app.fire("SetManager:enemyLives",this._enemyLives),this.app.fire("SetManager:playerLives",this._playerLives)}});var ScoreManager=pc.createScript("scoreManager");ScoreManager.attributes.add("startBonus",{type:"number",default:3e3}),ScoreManager.attributes.add("bonusDecreaseTime",{type:"number",default:2}),ScoreManager.attributes.add("bonusDecreaseAmount",{type:"number",default:25}),ScoreManager.attributes.add("hitBonus",{type:"number",default:50}),ScoreManager.attributes.add("curveBonus",{type:"number",default:25}),ScoreManager.attributes.add("superCurveBonus",{type:"number",default:50}),ScoreManager.attributes.add("accuracyBonus",{type:"number",default:50}),ScoreManager.attributes.add("bonusCountValue",{type:"number",default:25}),pc.extend(ScoreManager.prototype,{initialize:function(){pc.scoreManager=this,this.types=Object.freeze({CURVE:0,SUPERCURVE:1,ACCURACY:2}),this._highscore=pc.storageManager.get("highscore")||0,this.score=0,this.started=!1,this.bonusCountDown=!1,this.bonus=this.startBonus,this.bonusTimer=0,this.nextBonusTime=this.bonusDecreaseTime,this.app.on("GameManager:fullReset",this.fullReset,this),this.app.on("GameManager:start",this.start,this),this.app.on("GameManager:level",this.nextLevel,this),this.app.on("GameManager:roundCompleteEnemy",this.stop,this),this.app.on("GameManager:roundCompletePlayer",this.stop,this)},start:function(){this.started=!0},stop:function(){this.started=!1},nextLevel:function(){this.started=!1,this.resetBonus()},resetBonus:function(){this.bonus=this.startBonus,this.bonusTimer=0,this.nextBonusTime=this.bonusDecreaseTime,this.app.fire("ScoreManager:bonus",this.bonus)},resetScore:function(){this.score=0,this.updateScore()},reset:function(){this.resetScore(),this.resetBonus()},fullReset:function(){this.resetScore(),this.started=!1,this.bonusCountDown=!1,this.resetBonus()},update:function(t){if(this.started&&(this.bonusTimer+=t,this.bonusTimer>=this.nextBonusTime&&(this.bonus=pc.math.clamp(this.startBonus-Math.floor(this.bonusTimer/this.bonusDecreaseTime)*this.bonusDecreaseAmount,0,Number.POSITIVE_INFINITY),this.nextBonusTime+=this.bonusDecreaseTime,this.app.fire("ScoreManager:bonus",this.bonus))),this.bonusCountDown&&this.app.timeScale){var e=Math.min(this.bonus,this.bonusCountValue);this.score+=e,this.bonus-=e,this.updateScore(null,this.bonus<=0),this.app.fire("ScoreManager:bonus",this.bonus),this.bonus<=0&&(this.bonusCountDown=!1,pc.gameManager.finishedBonus())}this.updateLiveScore&&this.score>0&&(window.famobi_analytics.trackEvent("EVENT_LIVESCORE",{liveScore:this.score}),this.updateLiveScore=!1)},addHitBonus:function(){this.score+=this.hitBonus,this.updateScore()},addCurveBonus:function(){this.score+=this.curveBonus,this.updateScore(this.types.CURVE)},addSuperCurveBonus:function(){this.score+=this.superCurveBonus,this.updateScore(this.types.SUPERCURVE)},addAccuracyBonus:function(){this.score+=this.accuracyBonus,this.updateScore(this.types.ACCURACY)},applyBonus:function(){this.bonusCountDown=!0,this.bonusTimer=0},updateScore:function(t,e=!0){this.app.fire("ScoreManager:score",this.score,t),this.updateLiveScore=e},getScore:function(){return this.score},setHighscore:function(){this._highscore<this.score&&(this._highscore=this.score,pc.storageManager.set("highscore",this._highscore)),this.app.fire("ScoreManager:highscore",this._highscore)},getHighscore:function(){return this._highscore}});var GameScreen=pc.createScript("gameScreen");GameScreen.attributes.add("levelIndicator",{type:"entity"}),GameScreen.attributes.add("inGameUI",{type:"entity"}),GameScreen.attributes.add("levelIndicatorDelay",{type:"number",default:2}),GameScreen.attributes.add("scoreEntity",{type:"entity"}),GameScreen.attributes.add("bonusEntity",{type:"entity"}),GameScreen.attributes.add("scoreTextTemplate",{type:"string"}),GameScreen.attributes.add("levelTextTemplate",{type:"string"}),GameScreen.attributes.add("bonusTextTemplate",{type:"string"}),GameScreen.attributes.add("notificationEntity",{type:"entity"}),GameScreen.attributes.add("curveTextTemplate",{type:"string",default:"Curve Bonus!"}),GameScreen.attributes.add("superCurveTextTemplate",{type:"string",default:"Super Curve Bonus!"}),GameScreen.attributes.add("accuracyTextTemplate",{type:"string",default:"Accuracy Bonus!"}),GameScreen.attributes.add("pauseButton",{type:"entity"}),GameScreen.attributes.add("level",{type:"entity"}),GameScreen.attributes.add("levelText",{type:"entity"}),GameScreen.attributes.add("score",{type:"entity"}),GameScreen.attributes.add("lives",{type:"entity"}),pc.extend(GameScreen.prototype,{initialize:function(){this._player=pc.gameManager.getPlayerBat(),this._enemy=pc.gameManager.getEnemyBat(),this._ball=pc.gameManager.getBall(),this.states=Object.freeze({LEVEL:0,INGAME:1}),this.currentState=null,this.timer=0,this.app.on("SetManager:setLevel",this.onSetLevel),this.app.on("ScoreManager:score",this.onScoreChange,this),this.app.on("GameManager:level",this.onLevelChange,this),this.app.on("ScoreManager:bonus",this.onBonusChange,this),this.app.on("SetManager:playerLives",this.onPlayerLivesChange,this),this.app.on("SetManager:enemyLives",this.onEnemyLivesChange,this),window.famobi.onRequest("pauseGameplay",this.pause.bind(this)),window.famobi.onRequest("resumeGameplay",this.unpause.bind(this))},onUIEntityOpen:function(){this.setForcedModeProperties(),pc.famobiAPI.hasFeature("external_pause")&&(this.pauseButton.enabled=!1)},pause:function(){this.entity.enabled&&pc.gameManager.pause()},unpause:function(){this.entity.enabled&&pc.gameManager.unpause()},setForcedModeProperties:function(){var t=pc.gameManager.forcedModeProperties;t&&t.override.hide_ui&&(this.pauseButton.enabled=!t.override.hide_ui.includes("pause_button"),this.level.enabled=!t.override.hide_ui.includes("level"),this.levelText.enabled=!t.override.hide_ui.includes("level"),this.lives.enabled=!t.override.hide_ui.includes("lives"),this.score.enabled=!t.override.hide_ui.includes("score"),this.notificationEntity.enabled=!t.override.hide_ui.includes("bonus_notification"))},update:function(t){this.currentState===this.states.LEVEL&&(this.timer+=t,this.timer>=this.levelIndicatorDelay&&(this.switchState(this.states.INGAME),this.timer=0))},switchState:function(t){switch(this.currentState=t,this.currentState){case 0:this.levelIndicator.enabled=!0,this.inGameUI.enabled=!1,this.enableGameEntities(!1);break;case 1:this.levelIndicator.enabled=!1,this.inGameUI.enabled=!0,this.enableGameEntities(!0)}},onScoreChange:function(t,e){switch(this.changeText(this.scoreEntity,pc.utils.toNumberWithCommas(this.replaceTextVariable(this.scoreTextTemplate,t))),e){case pc.scoreManager.types.CURVE:this.setNotificationText(this.curveTextTemplate);break;case pc.scoreManager.types.SUPERCURVE:this.setNotificationText(this.superCurveTextTemplate);break;case pc.scoreManager.types.ACCURACY:this.setNotificationText(this.accuracyTextTemplate)}},onLevelChange:function(t){this.app.fire("levelInterface:changeLevel",t),this.switchState(this.states.INGAME)},onBonusChange:function(t){this.changeText(this.bonusEntity,pc.utils.toNumberWithCommas(this.replaceTextVariable(this.bonusTextTemplate,t)))},replaceTextVariable:function(t,e){return t.replace("{0}",String(e))},changeText:function(t,e){t.element.text=e},setNotificationText:function(t){this.notificationEntity.enabled&&(this.changeText(this.notificationEntity.children[0],t),this.notificationEntity.element.width=1.2*this.notificationEntity.children[0].element.width,this.notificationEntity.script.tweenPosition.startTween())},onPlayerLivesChange:function(t){pc.lifeInterface&&pc.lifeInterface.setPlayerLives(t)},onEnemyLivesChange:function(t){pc.lifeInterface&&pc.lifeInterface.setEnemyLives(t)},showLevelIndicator:function(t){this.changeText(this.levelIndicator,this.replaceTextVariable(this.levelTextTemplate,t)),this.switchState(this.states.LEVEL)},enableGameEntities:function(t){this._player.enabled=t,this._enemy.enabled=t,this._ball.enabled=t}});var DynamicScreen=pc.createScript("dynamicScreen");DynamicScreen.attributes.add("clampWidth",{type:"boolean",default:!0}),pc.extend(DynamicScreen.prototype,{initialize:function(){pc.famobiAPI.setOnOrientationChange(this.calculateDimensions,this),this.calculateDimensions()},calculateDimensions:function(){window.innerWidth,innerHeight;var t=pc.uiManager.getReferenceResolution().y/window.innerHeight;this.clampWidth?this.entity.element.width=pc.math.clamp(window.innerWidth*t,0,pc.uiManager.getReferenceResolution().x):this.entity.element.width=window.innerWidth*t,this.entity.element.height=window.innerHeight*t}});var PlayerBat=pc.createScript("playerBat");PlayerBat.attributes.add("halfExtent",{type:"vec4",default:[-3.5,3.5,-2,2]}),PlayerBat.attributes.add("quadrantMaterial",{type:"asset"}),PlayerBat.attributes.add("middleHitMaterial",{type:"asset"}),PlayerBat.attributes.add("emitCurveType",{type:"number",enum:[{LINEAR:0},{"SMOOTH-STEP":1},{SPLINE:2},{STEP:3}]}),PlayerBat.attributes.add("emitDuration",{type:"number",default:2}),PlayerBat.attributes.add("minOpacity",{type:"number",default:.4});var QuadrantHit={TOPLEFT:0,TOPRIGHT:1,BOTTOMLEFT:2,BOTTOMRIGHT:3,MIDDLE:4};Object.freeze(QuadrantHit),pc.extend(PlayerBat.prototype,{initialize:function(){this._pointer=new pc.Vec3,this.model=this.entity.model,this._oldPosition=[new pc.Vec2(this.entity.getPosition().x,this.entity.getPosition().y),new pc.Vec2(this.entity.getPosition().x,this.entity.getPosition().y),new pc.Vec2(this.entity.getPosition().x,this.entity.getPosition().y),new pc.Vec2(this.entity.getPosition().x,this.entity.getPosition().y),new pc.Vec2(this.entity.getPosition().x,this.entity.getPosition().y)],this._velocity=new pc.Vec2,this._camera=this.app.root.findOne(function(t){return t.tags.has("camera")}),this._z=5,this.app.on("CameraManager:onResize",this._setZDistance,this),this.app.on("GameManager:fullReset",this.onFullReset,this);var t=this.app.root.findByTag("wall"),e=this.entity.script.collider.halfExtents;this.clampHalfExtents=new pc.Vec4(t[0].getPosition().x+t[0].model.model.meshInstances[0].aabb.halfExtents.x+e.x,t[1].getPosition().x-t[1].model.model.meshInstances[0].aabb.halfExtents.x-e.x,t[3].getPosition().y+t[3].model.model.meshInstances[0].aabb.halfExtents.y+e.y,t[2].getPosition().y-t[2].model.model.meshInstances[0].aabb.halfExtents.y-e.y),this.defaultMaterial=this.quadrantMaterial.resource.clone(),this.emitCurve=new pc.Curve,this.createEmitCurve(),this.emitStarted=!1,this.timer=0;for(var i=0;i<this.model.meshInstances.length-1;i+=1){var s=this.quadrantMaterial.resource.clone();this.model.meshInstances[i].material=s}this.hit=null},update:function(t){if(this.emitStarted){this.timer+=t;for(var e=this.emitCurve.value(this.timer),i=0;i<this.model.meshInstances.length-1;i+=1)e<=this.minOpacity&&(i===this.hit&&this.hit===QuadrantHit.MIDDLE?this.model.meshInstances[i].material=this.middleHitMaterial.resource:this.model.meshInstances[i].material.opacity=e),e>=this.minOpacity&&this.hit===i&&this.hit!=QuadrantHit.MIDDLE&&(this.model.meshInstances[i].material.opacity=e),this.model.meshInstances[i].material.update();this.timer>=this.emitDuration&&(this.model.meshInstances[QuadrantHit.MIDDLE].material=this.defaultMaterial,this.emitStarted=!1,this.timer=0)}},createEmitCurve:function(){var t=this.emitDuration,e=this.emitCurve,i=t/2;e.type=this.emitCurveType,e.add(0,this.defaultMaterial.opacity),e.add(i,1),e.add(t,this.defaultMaterial.opacity),this.emitCurve=e},_setZDistance:function(t){this._z=t-10},onGoal:function(){this.onMove(new pc.Vec2(300,75))},onMove:function(t){this._camera.camera.screenToWorld(t.x,t.y,this._z,this._pointer),this.entity.setPosition(this._pointer);var e=this.entity.getPosition().x,i=this.entity.getPosition().y,s=this.entity.getPosition().z;e=pc.math.clamp(e,this.clampHalfExtents.x,this.clampHalfExtents.y),i=pc.math.clamp(i,this.clampHalfExtents.z,this.clampHalfExtents.w),this._pointer.set(e,i,s),this.entity.setPosition(this._pointer)},postUpdate:function(){this.setOldPosition()},setOldPosition:function(){for(var t=this.entity.getPosition(),e=0;e<this._oldPosition.length;e+=1){var i=e+1,s=this._oldPosition[i];s instanceof pc.Vec2?this._oldPosition[e].set(s.x,s.y):this._oldPosition[e].set(t.x,t.y)}},getVelocity:function(){var t=this._oldPosition[this._oldPosition.length-1].x-this._oldPosition[0].x,e=this._oldPosition[this._oldPosition.length-1].y-this._oldPosition[0].y;return this._velocity.set(t,e),this._velocity},setQuadrant:function(t,e){this.showQuadrantHit(t,e)},showQuadrantHit:function(t,e){if(!this.emitStarted){var i=null;if(e)i=QuadrantHit.MIDDLE;else{var s=t.x<=-.1,n=t.y>=.1;s&&n?i=QuadrantHit.TOPLEFT:s&&!n?i=QuadrantHit.BOTTOMLEFT:!s&&n?i=QuadrantHit.TOPRIGHT:s||n||(i=QuadrantHit.BOTTOMRIGHT)}null!==i&&(this.hit=i,this.emitStarted=!0)}},onFullReset:function(){this.emitStarted=!1,this.timer=0}});var EnemyBat=pc.createScript("enemyBat");EnemyBat.attributes.add("reactionSpeed",{type:"number",default:1}),EnemyBat.attributes.add("halfExtents",{type:"vec4",default:[-3.5,3.5,-2,2]}),EnemyBat.attributes.add("_maxSpeed",{type:"number",default:1}),EnemyBat.attributes.add("emitCurveType",{type:"number",enum:[{LINEAR:0},{"SMOOTH-STEP":1},{SPLINE:2},{STEP:3}]}),EnemyBat.attributes.add("emitDuration",{type:"number",default:2}),EnemyBat.attributes.add("minOpacity",{type:"number",default:.4}),EnemyBat.attributes.add("quadrantMaterial",{type:"asset"}),EnemyBat.attributes.add("middleHitMaterial",{type:"asset"});QuadrantHit={TOPLEFT:0,TOPRIGHT:1,BOTTOMLEFT:2,BOTTOMRIGHT:3,MIDDLE:4};Object.freeze(QuadrantHit),pc.extend(EnemyBat.prototype,{initialize:function(){this._ball=pc.gameManager.getBall(),this.model=this.entity.model,this._oldPosition=[new pc.Vec2(this.entity.getPosition().x,this.entity.getPosition().y),new pc.Vec2(this.entity.getPosition().x,this.entity.getPosition().y),new pc.Vec2(this.entity.getPosition().x,this.entity.getPosition().y),new pc.Vec2(this.entity.getPosition().x,this.entity.getPosition().y),new pc.Vec2(this.entity.getPosition().x,this.entity.getPosition().y)],this._maxSpeed=1,this._velocity=new pc.Vec2,this.app.on("GameManager:fullReset",this.onFullReset,this),this.defaultMaterial=this.quadrantMaterial.resource.clone(),this.emitCurve=new pc.Curve,this.createEmitCurve(),this.emitStarted=!1,this.timer=0;for(var t=0;t<this.model.meshInstances.length-1;t+=1){var e=this.quadrantMaterial.resource.clone();this.model.meshInstances[t].material=e}this.hit=null},update:function(t){if(pc.gameManager.isState(pc.gameManager.states.GAME)&&0!==t){var e=this._ball.script.ballMovement.shouldEnemyChase()?this._ball.getPosition():pc.Vec3.ZERO,i=this.entity.getPosition(),s=pc.math.lerp(i.x,e.x,this.reactionSpeed*t),n=pc.math.lerp(i.y,e.y,this.reactionSpeed*t);s=pc.math.clamp(s,this.halfExtents.x,this.halfExtents.y),n=pc.math.clamp(n,this.halfExtents.z,this.halfExtents.w);var a=this.getOldPosition();this._velocity.set(s-a.x,n-a.y);var o=this._velocity.length()/t;if(o>this._maxSpeed&&(this._velocity.scale(this._maxSpeed/o),s=a.x+this._velocity.x,n=a.y+this._velocity.y),this.entity.rigidbody.teleport(s,n,this.entity.position.z),this.emitStarted){this.timer+=t;for(var r=this.emitCurve.value(this.timer),h=0;h<this.model.meshInstances.length-1;h+=1)r<=this.minOpacity&&(h===this.hit&&this.hit===QuadrantHit.MIDDLE?this.model.meshInstances[h].material=this.middleHitMaterial.resource:this.model.meshInstances[h].material.opacity=r),r>=this.minOpacity&&this.hit===h&&this.hit!=QuadrantHit.MIDDLE&&(this.model.meshInstances[h].material.opacity=r),this.model.meshInstances[h].material.update();this.timer>=this.emitDuration&&(this.model.meshInstances[QuadrantHit.MIDDLE].material=this.defaultMaterial,this.emitStarted=!1,this.timer=0)}}},postUpdate:function(){this.setOldPosition()},setDifficultySettings:function(t,e){this.reactionSpeed=t,this._maxSpeed=e},setQuadrant:function(t,e){this.showQuadrantHit(t,e)},createEmitCurve:function(){var t=this.emitDuration,e=this.emitCurve,i=t/2;e.type=this.emitCurveType,e.add(0,this.defaultMaterial.opacity),e.add(i,1),e.add(t,this.defaultMaterial.opacity),this.emitCurve=e},showQuadrantHit:function(t,e){if(!this.emitStarted){var i=null;if(e)i=QuadrantHit.MIDDLE;else{var s=t.x<=-.1,n=t.y>=.1;s&&n?i=QuadrantHit.TOPLEFT:s&&!n?i=QuadrantHit.BOTTOMLEFT:!s&&n?i=QuadrantHit.TOPRIGHT:s||n||(i=QuadrantHit.BOTTOMRIGHT)}null!==i&&(this.hit=i,this.emitStarted=!0)}},setOldPosition:function(){for(var t=this.entity.getPosition(),e=0;e<this._oldPosition.length;e+=1){var i=e+1,s=this.getOldPosition(i);s instanceof pc.Vec2?this.getOldPosition(e).set(s.x,s.y):this.getOldPosition(e).set(t.x,t.y)}},getVelocity:function(){var t=this.getOldPosition(0),e=this.getOldPosition(),i=e.x-t.x,s=e.y-t.y;return this._velocity.set(i,s),this._velocity},getOldPosition:function(t){return this._oldPosition["number"==typeof t?t:this._oldPosition.length-1]},onFullReset:function(){this.emitStarted=!1,this.timer=0}});var PauseScreen=pc.createScript("pauseScreen");pc.extend(PauseScreen.prototype,{initialize:function(){},onUIEntityOpen:function(){this.app.timeScale=0},onUIEntityClose:function(){this.app.timeScale=1}});var WinScreen=pc.createScript("winScreen");WinScreen.attributes.add("scoreEntity",{type:"entity"}),pc.extend(WinScreen.prototype,{initialize:function(){},onUIEntityOpen:function(){pc.scoreManager.setHighscore(),this.scoreEntity.element.text=pc.utils.toNumberWithCommas(pc.scoreManager.getScore())},onUIEntityClose:function(){}});var LoseScreen=pc.createScript("loseScreen");LoseScreen.attributes.add("scoreEntity",{type:"entity"}),LoseScreen.attributes.add("retryButton",{type:"entity"}),LoseScreen.attributes.add("continueButton",{type:"entity"}),LoseScreen.attributes.add("amountOfLivesRegained",{type:"number",default:2}),LoseScreen.attributes.add("amountOfTimesForRetry",{type:"number",default:2}),pc.extend(LoseScreen.prototype,{initialize:function(){this.amountOfRetrys=0,this.clicked=!1,pc.util.BindCallbackToEvent(this.retryButton,this.watchAd,this),this.retryButton.enabled=pc.famobiAPI.hasRewardedAd(),this.app.on("GameManager:fullReset",this.reset,this),this.app.on("GameManager:level",this.level,this)},onUIEntityOpen:function(){pc.scoreManager.setHighscore(),this.scoreEntity.element.text=pc.utils.toNumberWithCommas(pc.scoreManager.getScore()),this.clicked=!1,this.amountOfRetrys<this.amountOfTimesForRetry?this.retryButton.enabled=pc.famobiAPI.hasRewardedAd():this.retryButton.enabled=!1,this.continueButton.enabled=!0},onUIEntityClose:function(){},watchAd:function(){this.clicked||(this.app.fire("Audio:sfx","sfx_button.mp3"),this.clicked=!0,this.amountOfRetrys+=1,this.continueButton.enabled=!1,pc.famobiAPI.rewardedAd(this.retry,this))},retry:function(t){t.rewardGranted&&(pc.setManager._playerLives=this.amountOfLivesRegained,this.app.fire("SetManager:playerLives",pc.setManager._playerLives),pc.gameManager.reset(),this.app.fire("UIManager:showUI","Game Screen"),this.app.fire("UIManager:hideUI","Lose Screen"),this.retryButton.button._isPressed=!1,this.retryButton.button._isHovering=!1,this.retryButton.button._visualState="DEFAULT",pc.gameManager.switchState(pc.gameManager.states.GAME)),this.clicked=!1},reset:function(){this.amountOfRetrys=0},level:function(){this.amountOfRetrys=0}});var CameraManager=pc.createScript("cameraManager");CameraManager.attributes.add("zCurve",{type:"curve",title:"Z distance Curve",description:"The x-axis represents the ratio of the resolution divided by 2."}),pc.extend(CameraManager.prototype,{initialize:function(){pc.famobiAPI.setOnOrientationChange(this.onResize,this)},postInitialize:function(){this.onResize()},onResize:function(){var t=window.innerWidth/window.innerHeight,e=this.zCurve.value(t/2);this.entity.setPosition(0,0,e),this.app.fire("CameraManager:onResize",e)}});var Collider=pc.createScript("collider");Collider.attributes.add("type",{type:"string",enum:[{Box:"box"}],default:"box"}),Collider.attributes.add("halfExtents",{type:"vec3",default:[.5,.5,.5]}),Collider.attributes.add("radius",{type:"number",default:.5}),pc.extend(Collider.prototype,{initialize:function(){},intersect:function(t){var e=t.collision||t.script.collider;if("box"===this.type&&"sphere"===e.type)return this._aabbBoxSphere(this.entity.getPosition(),this.halfExtents,t.getPosition(),e.radius);window.famobi.log("Types not recognized",this.type,e.type)},_aabbBoxSphere:function(t,e,i,s){var n=i.x,a=i.y,o=t.x,r=t.y,h=e.x,c=e.y,l=n,u=a;n<o-h?l=o-h:n>o+h&&(l=o+h),a<r-c?u=r-c:a>r+c&&(u=r+c);var p=n-l,d=a-u;return Math.sqrt(p*p+d*d)<=s}});var ChangeWallColor=pc.createScript("changeWallColor");ChangeWallColor.attributes.add("baseWallColor",{type:"rgb",default:[1,0,1]}),ChangeWallColor.attributes.add("wallColorPlayerScore",{type:"rgb",default:[1,0,1]}),ChangeWallColor.attributes.add("wallColorEnemyScore",{type:"rgb",default:[1,0,1]}),pc.extend(ChangeWallColor.prototype,{initialize:function(){this.app.on("GameManager:roundCompleteEnemy",this.playerWin,this),this.app.on("GameManager:roundCompletePlayer",this.enemyWin,this),this.app.on("GameManager:reset",this.reset,this)},playerWin:function(){this.app.fire("vibrate",500),pc.lightManager.startPulse(this.wallColorEnemyScore,this.baseWallColor,this.entity.model.model.meshInstances)},enemyWin:function(){this.app.fire("vibrate",500),pc.lightManager.startPulse(this.wallColorPlayerScore,this.baseWallColor,this.entity.model.model.meshInstances)},reset:function(){this.changeColor(this.baseWallColor)},changeColor:function(t){for(var e=this.entity.model.model.meshInstances.length,i=0;i<e;i+=1)this.entity.model.model.meshInstances[i].material.emissive=t,this.entity.model.model.meshInstances[i].material.diffuse=t,this.entity.model.model.meshInstances[i].material.update()}}),pc.util={},pc.util.rgb2hex=function(t){if(3===t.length){var e="#";return e+=("0"+parseInt(255*t[0],10).toString(16)).slice(-2),e+=("0"+parseInt(255*t[1],10).toString(16)).slice(-2),e+=("0"+parseInt(255*t[2],10).toString(16)).slice(-2)}},pc.util.RandomInt=function(t,e){return Math.floor(Math.random()*(e-t)+t)},pc.util.BindCallbackToEvent=function(t,e,i){null!=t&&(t.element.on("mouseup",e,i),t.element.on("touchend",e,i))},pc.util.MultiDimensionalArray=function(t){for(var e=[],i=0;i<t[0];i++)e.push(1===t.length?0:pc.util.MultiDimensionalArray(t.slice(1)));return e},pc.util.DifferenceBetween2Arrays=function(t,e){return t.filter(function(t){return e.indexOf(t)<0})},pc.util.ShuffleArray=function(t){for(var e,i,s=t.length;0!==s;)i=Math.floor(Math.random()*s),e=t[--s],t[s]=t[i],t[i]=e;return t},pc.util.gcd=function(t,e){for(e>t&&(temp=t,t=e,e=temp);0!==e;)m=t%e,t=e,e=m;return t},pc.util.ratio=function(t,e){return c=pc.util.gcd(t,e),new pc.Vec2(t/c,e/c)},pc.util.psuedoRandom=function(t,e,i){if(i<e)return console.warn("min is greater than max!");if(i===e)return e;var s=Math.round(pc.math.random(e,i));if(s!==t)return s;for(var n=[],a=i-e,o=0;o<=a;o+=1){var r=e+o;r!==t&&n.push(r)}return n[s=Math.round(pc.math.random(0,n.length-1))]};var BallColor=pc.createScript("ballColor");BallColor.attributes.add("ballColor",{type:"rgb",default:[1,0,1],title:"Color when moving"}),BallColor.attributes.add("ballColorDefeated",{type:"rgb",default:[1,0,1],title:"Color when hit player"}),BallColor.attributes.add("ballColorWin",{type:"rgb",default:[1,0,1],title:"Color when hit enemy"}),pc.extend(BallColor.prototype,{initialize:function(){this.changeColor(this.ballColor),this.app.on("GameManager:roundCompleteEnemy",this.playerWin,this),this.app.on("GameManager:roundCompletePlayer",this.enemyWin,this),this.app.on("GameManager:reset",this.reset,this),this._baseEmissionRate=this.entity.particlesystem.rate,this._baseLifeTime=this.entity.particlesystem.lifetime},reset:function(){this.changeColor(this.ballColor)},playerWin:function(){this.changeParticleSystem(!1),pc.lightManager.startPulse(this.ballColorDefeated,this.ballColor,this.entity.model.model.meshInstances,this,this.changeLightColor)},enemyWin:function(){this.changeParticleSystem(!1),pc.lightManager.startPulse(this.ballColorWin,this.ballColor,this.entity.model.model.meshInstances,this,this.changeLightColor)},changeLightColor:function(){this.entity.light.color=this.entity.model.model.meshInstances[0].material.diffuse},changeColor:function(t){for(var e=this.entity.model.model.meshInstances.length,i=0;i<e;i+=1)this.entity.model.model.meshInstances[i].material.emissive=t,this.entity.model.model.meshInstances[i].material.diffuse=t,this.entity.model.model.meshInstances[i].material.update();this.changeLightColor()},changeParticleSystem:function(t){t?this.entity.particlesystem.play():this.entity.particlesystem.stop()},setSpeed:function(t){this.entity.particlesystem.rate=this._baseEmissionRate/t,this.entity.particlesystem.rate2=this._baseEmissionRate/t,this.entity.particlesystem.lifetime=this._baseLifeTime/(t/3),this.entity.particlesystem.rebuild()}});var LevelInterface=pc.createScript("levelInterface");LevelInterface.attributes.add("disabledSprite",{type:"asset",assetType:"sprite"}),LevelInterface.attributes.add("enabledSprite",{type:"asset",assetType:"sprite"}),LevelInterface.attributes.add("finalDisabledSprite",{type:"asset",assetType:"sprite"}),LevelInterface.attributes.add("finalEnabledSprite",{type:"asset",assetType:"sprite"}),LevelInterface.attributes.add("animateLevelUp",{type:"boolean"}),LevelInterface.attributes.add("levelText",{type:"entity"}),pc.extend(LevelInterface.prototype,{initialize:function(){this.app.on("levelInterface:changeLevel",this.setLevel,this)},setLevel:function(t){if(this.levelText.element.text=t,this.entity.enabled)for(var e=0;e<this.entity.children.length;e+=1)this.setSprite(this.entity.children[e],e<t,e===this.entity.children.length-1),this.animateLevelUp&&e===t-1&&this.entity.children[e].script.tweenScale.startTween()},setSprite:function(t,e,i){t.element.sprite=i?e?this.finalEnabledSprite.resource:this.finalDisabledSprite.resource:e?this.enabledSprite.resource:this.disabledSprite.resource}});var DynamicElement,LifeInterface=pc.createScript("lifeInterface");LifeInterface.attributes.add("playerLives",{type:"entity"}),LifeInterface.attributes.add("enemyLives",{type:"entity"}),LifeInterface.attributes.add("playerEnabledSprite",{type:"asset",assetType:"sprite"}),LifeInterface.attributes.add("enemyEnabledSprite",{type:"asset",assetType:"sprite"}),LifeInterface.attributes.add("disabledSprite",{type:"asset",assetType:"sprite"}),pc.extend(LifeInterface.prototype,{initialize:function(){pc.lifeInterface=this,this.currentPlayerLives=0,this.currentEnemyLives=0},setPlayerLives:function(t){if(this.currentPlayerLives<t)for(var e=this.currentPlayerLives;e<t;e+=1)this.startPulseSpriteEnable(this.playerLives.children[e],!0);else if(this.currentPlayerLives>t)for(var i=this.currentPlayerLives;i>t;i-=1)this.startPulseSpriteDisable(this.playerLives.children[i-1],!0);this.currentPlayerLives=t},setEnemyLives:function(t){if(this.currentEnemyLives<t)for(var e=this.currentEnemyLives;e<t;e+=1)this.startPulseSpriteEnable(this.enemyLives.children[e],!1);else if(this.currentEnemyLives>t)for(var i=this.currentEnemyLives;i>t;i-=1)this.startPulseSpriteDisable(this.enemyLives.children[i-1],!1);this.currentEnemyLives=t},setEnemyTotalLives:function(t){for(var e=0;e<this.enemyLives.children.length;e+=1)this.enemyLives.children[e].enabled=e<t},setSprite:function(t,e,i){t.element.sprite=e?i?this.playerEnabledSprite.resource:this.enemyEnabledSprite.resource:this.disabledSprite.resource},startPulseSpriteEnable:function(t,e){t.enabled=!0,pc.pulse.startPulse(this,this.setSprite.bind(this,t,!0,e),this.setSprite.bind(this,t,!1,e),100,9,50)},startPulseSpriteDisable:function(t,e){pc.pulse.startPulse(this,this.setSprite.bind(this,t,!0,e),this.setSprite.bind(this,t,!1,e),50,10,10)}}),(DynamicElement=pc.createScript("dynamicElement")).attributes.add("scaleCurve",{type:"curve",default:{keys:[0,1]}}),pc.extend(DynamicElement.prototype,{initialize:function(){pc.famobiAPI.setOnOrientationChange(this.calculateDimensions,this),this.on("attr:maxWidth",this.calculateDimensions,this),this.calculateDimensions()},calculateDimensions:function(){var t=this.scaleCurve.value(window.innerWidth/window.innerHeight/2);this.entity.setLocalScale(t,t,t)}}),(DynamicElement=pc.createScript("dynamicElement")).prototype.initialize=function(){},DynamicElement.prototype.update=function(t){};var Utils=pc.createScript("utils");pc.extend(Utils.prototype,{initialize:function(){pc.utils=this},toNumberWithCommas:function(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},getRandomMinMax:function(t,e){return Math.random()*(e-t)+t}});var SoundButton=pc.createScript("soundButton");SoundButton.attributes.add("icon",{type:"entity"}),SoundButton.attributes.add("iconSprites",{type:"asset",assetType:"sprite",array:!0}),pc.extend(SoundButton.prototype,{initialize:function(){this.button=this.entity.button,this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("touchend",this.onRelease,this),this.on("state",function(t){this.setButtonState()}.bind(this))},postInitialize:function(){this.sfxKey=pc.audioManager.sfxSettingKey,this.setButtonState(),pc.famobiAPI.hasFeature("external_mute")&&this.entity.destroy()},setButtonState:function(){this.sfxKey&&(this.useSFX=pc.storageManager.get(this.sfxKey),this.setActive(this.useSFX))},onRelease:function(){this.useSFX=!this.useSFX,this.setActive(this.useSFX),this.app.fire("Audio:sfx","sfx_button.mp3")},setActive:function(t){this.icon.element.sprite=this.iconSprites[t?1:0].resource,this.app.fire("GameManager:initGame"),pc.storageManager.set(this.sfxKey,t?1:0),pc.audioManager.setSFXSetting(t)}});var WorldDynamicElement=pc.createScript("worldDynamicElement");WorldDynamicElement.attributes.add("portraitEntity",{type:"entity"}),WorldDynamicElement.attributes.add("landscapeEntity",{type:"entity"}),WorldDynamicElement.attributes.add("orientationTransition",{type:"number"}),WorldDynamicElement.attributes.add("scaleCurve",{type:"curve",curves:["x","y","z"],default:{keys:[[0,1],[0,1],[0,1]]}}),pc.extend(WorldDynamicElement.prototype,{initialize:function(){pc.famobiAPI.setOnOrientationChange(function(){setTimeout(this._calculateTransform.bind(this))},this),this.on("enable",this._calculateTransform,this)},_calculateTransform:function(){switch(innerWidth/innerHeight>this.orientationTransition?"landscape":"portrait"){case"landscape":this._setLandscapeTransform();break;case"portrait":this._setPortraitTransform()}},_setPortraitTransform:function(){var t=this.scaleCurve.value(innerWidth/innerHeight/2);this.entity.setLocalScale(t[0],t[1],t[2]);var e=pc.worldToScreenManager.worldToScreen(this.portraitEntity),i=pc.uiManager.getScale();this.entity.setLocalPosition((e.x*window.devicePixelRatio-this.app.graphicsDevice.width/2)/i,(this.app.graphicsDevice.height/2-e.y*window.devicePixelRatio)/i,0)},_setLandscapeTransform:function(){var t=this.scaleCurve.value(innerWidth/innerHeight/2);this.entity.setLocalScale(t[0],t[1],t[2]);var e=pc.worldToScreenManager.worldToScreen(this.landscapeEntity),i=pc.uiManager.getScale();this.entity.setLocalPosition((e.x*window.devicePixelRatio-this.app.graphicsDevice.width/2)/i,(this.app.graphicsDevice.height/2-e.y*window.devicePixelRatio)/i,0)}});var VibrateButton=pc.createScript("vibrateButton");VibrateButton.attributes.add("icon",{type:"entity"}),VibrateButton.attributes.add("iconSprites",{type:"asset",assetType:"sprite",array:!0}),pc.extend(VibrateButton.prototype,{initialize:function(){this.button=this.entity.button},postInitialize:function(){this.setVisibility()?(this.entity.element.on("click",this.onClick,this),this.setButtonState()):this.entity.destroy()},setVisibility:function(){return this.entity.enabled=pc.vibrationManager.isVibrationSupported(),this.entity.enabled},setButtonState:function(){this.vibrate=pc.storageManager.get("vibrate"),this.setActive(this.vibrate)},onClick:function(){this.app.fire("Audio:sfx","sfx_button.mp3"),this.vibrate=!this.vibrate,this.setActive(this.vibrate,!0)},setActive:function(t,e){this.icon.element.sprite=this.iconSprites[+t].resource,pc.vibrationManager.set(t),e&&t&&this.app.fire("vibrate")}});var MusicButton=pc.createScript("musicButton");MusicButton.attributes.add("icon",{type:"entity"}),MusicButton.attributes.add("iconSprites",{type:"asset",assetType:"sprite",array:!0}),pc.extend(MusicButton.prototype,{initialize:function(){this.button=this.entity.button,this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("touchend",this.onRelease,this),this.on("state",function(t){this.setButtonState()}.bind(this))},postInitialize:function(){this.bgmKey=pc.audioManager.bgmSettingKey,this.setButtonState(),pc.famobiAPI.hasFeature("external_mute")&&this.entity.destroy()},setButtonState:function(){this.bgmKey&&(this.useBgm=pc.storageManager.get(this.bgmKey),this.setActive(this.useBgm))},onRelease:function(){this.app.fire("Audio:sfx","sfx_button.mp3"),this.useBgm=!this.useBgm,this.setActive(this.useBgm)},setActive:function(t){this.icon.element.sprite=this.iconSprites[t?1:0].resource,this.app.fire("GameManager:initGame"),pc.storageManager.set(this.bgmKey,t?1:0),pc.audioManager.setBGMSetting(t)}});var WorldToscreenManager=pc.createScript("worldToscreenManager");WorldToscreenManager.attributes.add("camera",{type:"entity"}),pc.extend(WorldToscreenManager.prototype,{initialize:function(){pc.worldToScreenManager=this},worldToScreen:function(t){return this.camera.camera.worldToScreen(t.getPosition())}});var HamburgerMenu=pc.createScript("hamburgerMenu");HamburgerMenu.attributes.add("menuButton",{type:"entity"}),HamburgerMenu.attributes.add("content",{type:"entity",array:!0}),HamburgerMenu.attributes.add("unfoldDirectionType",{type:"number",enum:[{top:0},{bottom:1},{left:2},{right:3}]}),HamburgerMenu.attributes.add("unfoldDistance",{type:"number",default:120}),HamburgerMenu.attributes.add("unfoldDuration",{type:"number",default:.1}),HamburgerMenu.attributes.add("autoCloseTimer",{type:"number",default:4}),pc.extend(HamburgerMenu.prototype,{initialize:function(){this.directionTranslate=[new pc.Vec2(0,1),new pc.Vec2(0,-1),new pc.Vec2(-1,0),new pc.Vec2(1,0)],this.unfoldDirection=this.directionTranslate[this.unfoldDirectionType],this.countdown=!1,this.counter=0,this.isOpen=!1,this.menuButton.element.on("mousedown",this._onPress,this),this.menuButton.element.on("touchstart",this._onPress,this)},postInitialize:function(){setTimeout(()=>{for(var t=!1,e=this.content.length-1;e>=0;e--)this.content[e].parent?t=!0:this.content.splice(e,1);t||this.entity.destroy()})},update:function(t){this.countdown&&(this.counter-=t,this.counter<=0&&(this.countdown=!1,this.counter=0,this.toggleMenu(!1,!1)))},_onPress:function(){this.toggleMenu(),this.app.fire("Audio:sfx","sfx_button.mp3")},toggleMenu:function(t,e){this.isOpen=void 0===e?!this.isOpen:e,this.isOpen&&this.autoCloseTimer&&0!==this.autoCloseTimer&&(this.countdown=!0,this.counter=this.autoCloseTimer);for(var i=0;i<this.content.length;i+=1)this._setItemPosition(this.content[i],this.isOpen?this.unfoldDirection.clone().scale(this.unfoldDistance*(i+1)):new pc.Vec2(0,0),t)},_setItemPosition:function(t,e,i){if(i)t.setLocalPosition(e.x,e.y,0);else{var s=new pc.Vec3(e.x,e.y,0);t.tween(t.getLocalPosition()).to(s,this.unfoldDuration,pc.SineOut).start()}}}),pc.extend(pc,function(){var t=function(t){this._app=t,this._tweens=[],this._add=[]};t.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var e=0,i=this._tweens.length;e<i;)this._tweens[e].update(t)?e++:(this._tweens.splice(e,1),i--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var e=function(t,e,i){pc.events.attach(this),this.manager=e,i&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.EASE_LINEAR,this._sv={},this._ev={}};e.prototype={to:function(t,e,i,s,n,a){return t instanceof pc.Vec3?this._properties={x:t.x,y:t.y,z:t.z}:t instanceof pc.Color?(this._properties={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(this._properties.a=t.a)):this._properties=t,this.duration=e,i&&(this.easing=i),s&&this.delay(s),n&&this.repeat(n),a&&this.yoyo(a),this},from:function(t,e,i,s,n,a){return t instanceof pc.Vec3?this._properties={x:t.x,y:t.y,z:t.z}:t instanceof pc.Color?(this._properties={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(this._properties.a=t.a)):this._properties=t,this.duration=e,i&&(this.easing=i),s&&this.delay(s),n&&this.repeat(n),a&&this.yoyo(a),this._from=!0,this},rotate:function(t,e,i,s,n,a){return t instanceof pc.Quat?this._properties={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Vec3?this._properties={x:t.x,y:t.y,z:t.z}:t instanceof pc.Color?(this._properties={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(this._properties.a=t.a)):this._properties=t,this.duration=e,i&&(this.easing=i),s&&this.delay(s),n&&this.repeat(n),a&&this.yoyo(a),this._slerp=!0,this},start:function(){if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(var t in this._properties)this._sv[t]=this._properties[t],this._ev[t]=this.target[t];if(this._slerp){this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z);var e=void 0!==this._properties.x?this._properties.x:this.target.x,i=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z;this._fromQuat.setFromEulerAngles(e,i,s)}}else{for(var t in this._properties)this._sv[t]=this.target[t],this._ev[t]=this._properties[t];if(this._slerp){this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z);e=void 0!==this._properties.x?this._properties.x:this.target.x,i=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z;this._toQuat.setFromEulerAngles(e,i,s)}}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,e){return this._count=0,this._numRepeats=t,this._repeatDelay=e||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time=this.time-this._currentDelay,this.pending=!1}var e=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(e=this.duration-this.time,this.time=0):(e=this.time-this.duration,this.time=this.duration));var i,s,n=this.time/this.duration,a=this.easing(n);for(var o in this._properties)i=this._sv[o],s=this._ev[o],this.target[o]=i+(s-i)*a;if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,a),this.entity&&(this.entity._dirtifyLocal(!0),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var r=this._repeat(e);return r?this.fire("loop"):(this.fire("complete",e),this._chained&&this._chained.start()),r}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var e in this._properties)tmp=this._sv[e],this._sv[e]=this._ev[e],this._ev[e]=tmp;this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var i=function(t){return 1-s(1-t)},s=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};return{TweenManager:t,Tween:e,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},BackOut:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},BackInOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)},BounceIn:i,BounceOut:s,BounceInOut:function(t){return t<.5?.5*i(2*t):.5*s(2*t-1)+.5},ElasticIn:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))},ElasticOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var e,i=.1,s=.4;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=s*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/s)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/s)*.5+1)}}}()),function(){var t=pc.Application.getApplication();t&&(t._tweenManager=new pc.TweenManager(t),t.on("update",function(e){t._tweenManager.update(e)}),pc.Application.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,e){var i=this._app.tween(t);return i.entity=this,this.on("destroy",function(){i.stop()}),e&&e.element&&(i.element=element),i})}();var Pulse=pc.createScript("pulse");pc.extend(Pulse.prototype,{initialize:function(){pc.pulse=this},startPulse:function(t,e,i,s,n,a,o,r){var h={currentCall:0,cb:[]};h.cb.push(e,i),h.intervalCB=o,h.doneCB=r,h.context=t,h.interval=s,h.amount=n,h.intervalRandomness="number"==typeof a?a:0,this.doPulse(h)},doPulse:function(t){t.cb[t.currentCall%2].call(t.context),t.currentCall+=1,"function"==typeof t.intervalCB&&t.intervalCB.call(t.context);var e=pc.utils.getRandomMinMax(t.interval-t.intervalRandomness,t.interval+t.intervalRandomness);t.currentCall<t.amount?setTimeout(this.doPulse.bind(this,t),e):"function"==typeof t.doneCB&&t.doneCB.call(t.context)}});var LightManager=pc.createScript("lightManager");LightManager.attributes.add("pulseInterval",{type:"number",default:50}),LightManager.attributes.add("pulseAmount",{type:"number",default:8}),LightManager.attributes.add("intervalRandomness",{type:"number",default:0}),pc.extend(LightManager.prototype,{initialize:function(){pc.lightManager=this},startPulse:function(t,e,i,s,n,a){var o="function"==typeof n?n.bind(s):void 0,r="function"==typeof a?a.bind(s):void 0;pc.pulse.startPulse(this,this.changeColor.bind(this,t,i),this.changeColor.bind(this,e,i),this.pulseInterval,this.pulseAmount,this.intervalRandomness,o,r)},changeColor:function(t,e){for(var i=0;i<e.length;i+=1)e[i].material.emissive=t,e[i].material.diffuse=t,e[i].material.update()}});var Highscore=pc.createScript("highscore");pc.extend(Highscore.prototype,{initialize:function(){this.app.on("ScoreManager:highscore",this._setText,this)},postInitialize:function(){this._setText(pc.scoreManager.getHighscore())},_setText:function(t){this.entity.element.text=String(pc.utils.toNumberWithCommas(t))}});var StatisticsManager=pc.createScript("statisticsManager");pc.extend(StatisticsManager.prototype,{initialize:function(){StatisticsManager.instance=this,this.app.on("StatisticsManager:incrementStatistic",this.incrementStatistic,this),this.app.on("StatisticsManager:setStatistic",this.setStatistic,this)},incrementStatistic:function(t,e){e+=pc.storageManager.get(t),pc.storageManager.set(t,e),window.famobi_analytics.trackStats(t,e)},setStatistic:function(t,e,i){var s=pc.storageManager.get(t);s!==e&&(i&&s>e||(pc.storageManager.set(t,e),window.famobi_analytics.trackStats(t,e)))}});var LoseButton=pc.createScript("loseButton");pc.extend(LoseButton.prototype,{initialize:function(){this._clicked=!1,this.entity.script.switchUibutton.deactivate(),this.entity.script.switchUibutton.on("click",this._onClick,this)},_onClick:function(){if(!this._clicked){this._clicked=!0;var t=window.famobi_analytics.trackEvent(window.famobi_analytics.EVENT_LEVELFAIL,{levelName:"level_"+pc.gameManager.level,reason:"dead"}),e=window.famobi_analytics.trackEvent(window.famobi_analytics.EVENT_TOTALSCORE,{totalScore:pc.scoreManager.score}),i=window.famobi_analytics.trackEvent(window.famobi_analytics.EVENT_CUSTOM,{eventName:"LEVELEND",result:"fail",score:pc.scoreManager.score});return Promise.all([t,e,i]).then(function(){this._onEvent()}.bind(this))}},_onEvent:function(){this._clicked=!1,this.entity.script.switchUibutton.changeUIEntities()}});var EventTrackButton=pc.createScript("eventTrackButton");pc.extend(EventTrackButton.prototype,{initialize:function(){this._clicked=!1,this.entity.script.switchUibutton.deactivate(),this.entity.script.switchUibutton.on("click",this._onClick,this)},_onClick:function(){if(!this._clicked){this._clicked=!0;var t=window.famobi_analytics.trackEvent(window.famobi_analytics.EVENT_LEVELSTART,{levelName:"level_"+pc.gameManager.level});return 1===pc.gameManager.level&&StatisticsManager.instance.incrementStatistic("statistics_amount_of_level_one_starts",1),Promise.all([t]).then(function(){this._onEvent()}.bind(this))}},_onEvent:function(){this._clicked=!1,this.entity.script.switchUibutton.changeUIEntities(),pc.famobiAPI.playerReady()}});var Copyright=pc.createScript("copyright");pc.extend(Copyright.prototype,{initialize:function(){this.onEnable(),this.on("enable",this.onEnable,this)},onEnable:function(){let t=pc.famobiAPI.hasFeature("copyright");this.entity.enabled=t,t&&(this.entity.element.text="(C) Famobi")}}),pc.extend(pc.Camera.prototype,{screenToWorld:function(t,e,i,s,n,a=new pc.Vec3){this._updateViewProjMat(),_invViewProjMat.copy(this._viewProjMat).invert(),_far.set(t/s*2-1,(n-e)/n*2-1,1),_invViewProjMat.transformPoint(_far,_farW);var o=_far.x*_invViewProjMat.data[3]+_far.y*_invViewProjMat.data[7]+_far.z*_invViewProjMat.data[11]+_invViewProjMat.data[15];_farW.scale(1/o);var r=i/this._farClip;return a.lerp(this._node.getPosition(),_farW,r),a}});var _deviceCoord=new pc.Vec3,_far=new pc.Vec3,_farW=new pc.Vec3,_invViewProjMat=new pc.Mat4,BrandingButton=pc.createScript("brandingButton");pc.extend(BrandingButton.prototype,{initialize:function(){var t=window.famobi.getBrandingButtonImage(),e=new pc.Asset("famobi_branding_button","texture",{url:t});this.app.assets.add(e),pc.lazyLoader.lazyLoad(e,this.onLoadedAsset,this),this.entity.element.on("mouseup",this.onRelease,this),this.entity.element.on("touchend",this.onRelease,this)},onLoadedAsset:function(t){this.entity.element.enabled=!0,this.entity.element.texture=t.resource},onRelease:function(){window.famobi.openBrandingLink()}});